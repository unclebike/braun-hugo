export declare const BOOKING_WIDGET_JS = "(function() {\n  'use strict';\n\n  var WIDGET_VERSION = '2.0.0';\n\n  function GOATkitWidget(config) {\n    this.apiUrl = config.apiUrl || '';\n    this.apiKey = config.apiKey || '';\n    this.containerId = config.containerId || 'goatkit-widget';\n    this.primaryColor = config.primaryColor || '#2563eb';\n    this.fontFamily = config.fontFamily || \"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif\";\n    this.onComplete = config.onComplete || function() {};\n    this.onError = config.onError || function() {};\n    this.onStepChange = config.onStepChange || function() {};\n\n    this.state = {\n      currentStep: 'zip',\n      stepHistory: ['zip'],\n      postalCode: '',\n      territory: null,\n      categories: [],\n      selectedCategory: null,\n      services: [],\n      selectedService: null,\n      serviceDetail: null,\n      modifierSelections: {},\n      timeslots: [],\n      selectedDate: null,\n      selectedTimeslot: null,\n      dateWindowStart: 0,\n      address: { line1: '', line2: '', city: '', province: '', postalCode: '' },\n      contact: { firstName: '', lastName: '', email: '', phone: '' },\n      loading: false,\n      error: null,\n      summaryExpanded: false,\n      smsConsent: false,\n      jobId: null\n    };\n\n    this._acTimer = null;\n    this._acAbort = null;\n    this._prevStep = null;\n    this.init();\n  }\n\n  GOATkitWidget.prototype.init = function() {\n    this.injectStyles();\n    this.render();\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // CSS\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.injectStyles = function() {\n    if (document.getElementById('zbw-styles')) return;\n    var s = document.createElement('style');\n    s.id = 'zbw-styles';\n    s.textContent = this.getCSS();\n    document.head.appendChild(s);\n  };\n\n  GOATkitWidget.prototype.getCSS = function() {\n    var p = this.primaryColor;\n    var f = this.fontFamily;\n    return [\n      ':root{--zbw-p:' + p + ';--zbw-pl:' + p + '14;--zbw-f:' + f + '}',\n\n      '.zbw-root{font-family:var(--zbw-f);color:#1a1a1a;line-height:1.5;box-sizing:border-box;-webkit-font-smoothing:antialiased}',\n      '.zbw-root *,.zbw-root *::before,.zbw-root *::after{box-sizing:inherit}',\n\n      '.zbw-layout{display:flex;flex-direction:column;gap:0;max-width:860px;margin:0 auto}',\n      '@media(min-width:768px){.zbw-layout{flex-direction:row;gap:24px}}',\n\n      '.zbw-main{flex:1;min-width:0}',\n      '.zbw-sidebar{display:none}',\n      '@media(min-width:768px){.zbw-sidebar{display:block;width:280px;flex-shrink:0}}',\n\n      '.zbw-mobile-summary{display:block;margin-bottom:16px}',\n      '@media(min-width:768px){.zbw-mobile-summary{display:none}}',\n      '.zbw-mobile-summary-btn{width:100%;padding:12px 16px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-family:var(--zbw-f);font-size:14px;color:#475569}',\n      '.zbw-mobile-summary-btn strong{color:#1a1a1a}',\n\n      '.zbw-progress{margin-bottom:24px}',\n      '.zbw-progress-bar{height:4px;background:#e2e8f0;border-radius:2px;overflow:hidden}',\n      '.zbw-progress-fill{height:100%;background:var(--zbw-p);border-radius:2px;transition:width .4s ease}',\n      '.zbw-progress-text{font-size:12px;color:#94a3b8;margin-top:6px}',\n\n      '.zbw-step{animation:zbw-fadeIn .25s ease}',\n      '@keyframes zbw-fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}',\n\n      '.zbw-step-title{font-size:22px;font-weight:700;margin:0 0 4px;color:#0f172a}',\n      '.zbw-step-desc{font-size:14px;color:#64748b;margin:0 0 20px}',\n\n      '.zbw-card{padding:16px;border:2px solid #e2e8f0;border-radius:10px;cursor:pointer;transition:all .15s ease;background:#fff}',\n      '.zbw-card:hover{border-color:' + p + '66;box-shadow:0 2px 8px rgba(0,0,0,.06)}',\n      '.zbw-card.selected{border-color:var(--zbw-p);background:' + p + '08}',\n      '.zbw-card-title{font-weight:600;font-size:15px;margin-bottom:2px}',\n      '.zbw-card-desc{font-size:13px;color:#64748b;margin-bottom:8px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}',\n      '.zbw-card-meta{display:flex;justify-content:space-between;align-items:center;font-size:14px}',\n      '.zbw-card-price{font-weight:700;color:var(--zbw-p)}',\n      '.zbw-card-duration{color:#94a3b8;font-size:13px}',\n      '.zbw-cards{display:grid;gap:10px;margin-bottom:16px}',\n\n      '.zbw-modifier-card{padding:20px;border:2px solid #e2e8f0;border-radius:10px;cursor:pointer;transition:all .15s ease;background:#fff;text-align:center}',\n      '.zbw-modifier-card:hover{border-color:' + p + '66}',\n      '.zbw-modifier-card.selected{border-color:var(--zbw-p);background:' + p + '08}',\n      '.zbw-modifier-name{font-weight:600;font-size:16px;margin-bottom:4px}',\n      '.zbw-modifier-desc{font-size:13px;color:#64748b;margin-bottom:8px}',\n      '.zbw-modifier-price{font-weight:700;color:var(--zbw-p);font-size:15px}',\n\n      '.zbw-date-chips{display:flex;align-items:center;gap:6px;margin-bottom:16px;overflow:hidden}',\n      '.zbw-date-chip{flex-shrink:0;padding:10px 14px;border:2px solid #e2e8f0;border-radius:10px;cursor:pointer;text-align:center;transition:all .15s;background:#fff;min-width:64px}',\n      '.zbw-date-chip:hover{border-color:' + p + '66}',\n      '.zbw-date-chip.selected{border-color:var(--zbw-p);background:' + p + '08}',\n      '.zbw-date-chip.empty{opacity:.4;pointer-events:none}',\n      '.zbw-date-day{font-size:12px;color:#64748b;font-weight:400}',\n      '.zbw-date-num{font-size:15px;font-weight:700;margin-top:2px}',\n      '.zbw-date-nav{width:32px;height:32px;border-radius:50%;border:1px solid #e2e8f0;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:18px;color:#475569;transition:all .15s}',\n      '.zbw-date-nav:hover{background:#f1f5f9}',\n      '.zbw-date-nav:disabled{opacity:.3;cursor:not-allowed}',\n\n      '.zbw-timeslots{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;margin-bottom:16px;max-height:280px;overflow-y:auto}',\n      '.zbw-timeslot{padding:12px 8px;border:2px solid #e2e8f0;border-radius:8px;text-align:center;cursor:pointer;transition:all .15s;background:#fff}',\n      '.zbw-timeslot:hover{border-color:' + p + '66}',\n      '.zbw-timeslot.selected{border-color:var(--zbw-p);background:' + p + '08}',\n      '.zbw-timeslot-time{font-weight:600;font-size:14px}',\n      '.zbw-timeslot-price{font-size:12px;color:#64748b;margin-top:2px}',\n\n      '.zbw-form-group{margin-bottom:14px}',\n      '.zbw-form-group label{display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:5px}',\n'.zbw-input{width:100%;padding:11px 14px;border:1.5px solid #d1d5db;border-radius:8px;font-size:16px;font-family:var(--zbw-f);color:#1a1a1a;background:#fff;transition:border-color .15s,box-shadow .15s;outline:none}',\n      '.zbw-input:focus{border-color:var(--zbw-p);box-shadow:0 0 0 3px ' + p + '1a}',\n      '.zbw-input::placeholder{color:#9ca3af}',\n      '.zbw-input-error{border-color:#ef4444}',\n      'select.zbw-input{appearance:none;background-image:url(\"data:image/svg+xml,%3Csvg width=\\'10\\' height=\\'6\\' viewBox=\\'0 0 10 6\\' fill=\\'none\\' xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cpath d=\\'M1 1L5 5L9 1\\' stroke=\\'%236b7280\\' stroke-width=\\'1.5\\' stroke-linecap=\\'round\\' stroke-linejoin=\\'round\\'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:right 12px center;padding-right:36px}',\n      '.zbw-ac-wrap{position:relative}',\n      '.zbw-ac-list{position:absolute;top:100%;left:0;right:0;background:#fff;border:1.5px solid #d1d5db;border-top:none;border-radius:0 0 8px 8px;z-index:100;max-height:240px;overflow-y:auto;box-shadow:0 4px 12px rgba(0,0,0,.1)}',\n      '.zbw-ac-list:empty{display:none}',\n      '.zbw-ac-item{padding:10px 14px;cursor:pointer;border-bottom:1px solid #f1f5f9;transition:background .1s}',\n      '.zbw-ac-item:last-child{border-bottom:none}',\n      '.zbw-ac-item:hover{background:#f8fafc}',\n      '.zbw-ac-main{font-size:14px;font-weight:600;color:#1a1a1a}',\n      '.zbw-ac-sub{font-size:12px;color:#64748b;margin-top:1px}',\n      '.zbw-row{display:flex;gap:12px}',\n      '.zbw-row .zbw-form-group{flex:1}',\n\n      '.zbw-btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 24px;border:none;border-radius:8px;font-size:15px;font-weight:600;font-family:var(--zbw-f);cursor:pointer;transition:all .15s;width:100%}',\n      '.zbw-btn-primary{background:var(--zbw-p);color:#fff}',\n      '.zbw-btn-primary:hover{opacity:.92}',\n      '.zbw-btn-primary:disabled{background:#cbd5e1;cursor:not-allowed}',\n      '.zbw-btn-secondary{background:#f1f5f9;color:#475569;margin-top:8px}',\n      '.zbw-btn-secondary:hover{background:#e2e8f0}',\n      '.zbw-btn-back{background:none;border:none;color:#64748b;font-size:14px;font-weight:400;cursor:pointer;padding:8px 0;font-family:var(--zbw-f);display:inline-flex;align-items:center;gap:4px}',\n      '.zbw-btn-back:hover{color:#1a1a1a}',\n\n      '.zbw-error{background:#fef2f2;color:#dc2626;padding:12px 16px;border-radius:8px;margin-bottom:16px;font-size:14px;border:1px solid #fecaca}',\n\n      '.zbw-summary-panel{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:20px;position:sticky;top:24px}',\n      '.zbw-summary-title{font-size:13px;font-weight:600;color:#94a3b8;text-transform:uppercase;letter-spacing:.05em;margin-bottom:12px}',\n      '.zbw-summary-service{font-size:16px;font-weight:700;margin-bottom:12px;color:#0f172a}',\n      '.zbw-summary-item{display:flex;justify-content:space-between;font-size:13px;padding:4px 0;color:#475569}',\n      '.zbw-summary-item.mod{color:#64748b}',\n      '.zbw-summary-divider{border:none;border-top:1px solid #e2e8f0;margin:10px 0}',\n      '.zbw-summary-total{display:flex;justify-content:space-between;font-size:16px;font-weight:700;color:#0f172a}',\n      '.zbw-summary-detail{display:flex;align-items:center;gap:8px;font-size:13px;color:#64748b;margin-bottom:6px}',\n      '.zbw-summary-detail svg{flex-shrink:0}',\n\n      '.zbw-success{text-align:center;padding:32px 16px}',\n      '.zbw-success-icon{width:56px;height:56px;border-radius:50%;background:#dcfce7;margin:0 auto 16px;display:flex;align-items:center;justify-content:center}',\n      '.zbw-success-icon svg{color:#16a34a}',\n      '.zbw-success h2{font-size:22px;margin:0 0 8px}',\n      '.zbw-success p{color:#64748b;font-size:14px;margin:4px 0}',\n\n      '.zbw-skeleton{background:linear-gradient(90deg,#f1f5f9 25%,#e2e8f0 50%,#f1f5f9 75%);background-size:200% 100%;animation:zbw-shimmer 1.5s infinite;border-radius:8px}',\n      '@keyframes zbw-shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}',\n      '.zbw-skeleton-card{height:80px;margin-bottom:10px}',\n      '.zbw-skeleton-text{height:14px;margin-bottom:8px;width:60%}',\n      '.zbw-skeleton-chip{height:56px;width:64px;border-radius:10px;flex-shrink:0}',\n\n      '[data-theme=\"dark\"] .zbw-root{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-step-title{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-step-desc{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-card{background:#1e1e2e;border-color:#313244;color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-card:hover{border-color:' + p + '88;box-shadow:0 2px 8px rgba(0,0,0,.3)}',\n      '[data-theme=\"dark\"] .zbw-card.selected{border-color:var(--zbw-p);background:' + p + '18}',\n      '[data-theme=\"dark\"] .zbw-card-title{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-card-desc{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-card-duration{color:#6c7086}',\n      '[data-theme=\"dark\"] .zbw-modifier-card{background:#1e1e2e;border-color:#313244;color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-modifier-card:hover{border-color:' + p + '88}',\n      '[data-theme=\"dark\"] .zbw-modifier-card.selected{border-color:var(--zbw-p);background:' + p + '18}',\n      '[data-theme=\"dark\"] .zbw-modifier-name{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-modifier-desc{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-date-chip{background:#1e1e2e;border-color:#313244;color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-date-chip:hover{border-color:' + p + '88}',\n      '[data-theme=\"dark\"] .zbw-date-chip.selected{border-color:var(--zbw-p);background:' + p + '18}',\n      '[data-theme=\"dark\"] .zbw-date-day{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-date-num{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-date-nav{background:#1e1e2e;border-color:#313244;color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-date-nav:hover{background:#313244}',\n      '[data-theme=\"dark\"] .zbw-timeslot{background:#1e1e2e;border-color:#313244;color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-timeslot:hover{border-color:' + p + '88}',\n      '[data-theme=\"dark\"] .zbw-timeslot.selected{border-color:var(--zbw-p);background:' + p + '18}',\n      '[data-theme=\"dark\"] .zbw-timeslot-time{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-timeslot-price{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-input{background:#181825;border-color:#313244;color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-input:focus{border-color:var(--zbw-p);box-shadow:0 0 0 3px ' + p + '33}',\n      '[data-theme=\"dark\"] .zbw-input::placeholder{color:#6c7086}',\n      '[data-theme=\"dark\"] .zbw-form-group label{color:#bac2de}',\n      '[data-theme=\"dark\"] .zbw-btn-secondary{background:#313244;color:#bac2de}',\n      '[data-theme=\"dark\"] .zbw-btn-secondary:hover{background:#45475a}',\n      '[data-theme=\"dark\"] .zbw-btn-back{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-btn-back:hover{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-btn-primary:disabled{background:#45475a;color:#6c7086}',\n      '[data-theme=\"dark\"] .zbw-error{background:#45475a;color:#f38ba8;border-color:#f38ba866}',\n      '[data-theme=\"dark\"] .zbw-progress-bar{background:#313244}',\n      '[data-theme=\"dark\"] .zbw-progress-text{color:#6c7086}',\n      '[data-theme=\"dark\"] .zbw-summary-panel{background:#181825;border-color:#313244}',\n      '[data-theme=\"dark\"] .zbw-summary-title{color:#6c7086}',\n      '[data-theme=\"dark\"] .zbw-summary-service{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-summary-item{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-summary-divider{border-color:#313244}',\n      '[data-theme=\"dark\"] .zbw-summary-total{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-summary-detail{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-mobile-summary-btn{background:#181825;border-color:#313244;color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-mobile-summary-btn strong{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-success h2{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-success p{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-ac-list{background:#1e1e2e;border-color:#313244;box-shadow:0 4px 12px rgba(0,0,0,.4)}',\n      '[data-theme=\"dark\"] .zbw-ac-item{border-bottom-color:#313244}',\n      '[data-theme=\"dark\"] .zbw-ac-item:hover{background:#313244}',\n      '[data-theme=\"dark\"] .zbw-ac-main{color:#cdd6f4}',\n      '[data-theme=\"dark\"] .zbw-ac-sub{color:#a6adc8}',\n      '[data-theme=\"dark\"] .zbw-skeleton{background:linear-gradient(90deg,#313244 25%,#45475a 50%,#313244 75%);background-size:200% 100%}'\n    ].join('\\n');\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // UTILITIES\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.formatPrice = function(cents) {\n    if (cents == null) return '--';\n    var dollars = Math.abs(cents) / 100;\n    var sign = cents < 0 ? '-' : '';\n    return sign + '\\$' + dollars.toFixed(dollars % 1 === 0 ? 0 : 2);\n  };\n\n  GOATkitWidget.prototype.formatPriceDelta = function(cents) {\n    if (!cents) return 'Included';\n    return '+\\$' + (Math.abs(cents) / 100).toFixed(cents % 100 === 0 ? 0 : 2);\n  };\n\n  GOATkitWidget.prototype.formatTime = function(time24) {\n    var parts = time24.split(':');\n    var h = parseInt(parts[0], 10);\n    var m = parts[1];\n    var ampm = h >= 12 ? 'PM' : 'AM';\n    return (h % 12 || 12) + ':' + m + ' ' + ampm;\n  };\n\n  GOATkitWidget.prototype.formatDate = function(dateStr) {\n    var d = new Date(dateStr + 'T12:00:00');\n    return d.toLocaleDateString('en-US', { timeZone: 'America/Toronto', weekday: 'short', month: 'short', day: 'numeric' });\n  };\n\n  GOATkitWidget.prototype.formatDateShort = function(dateStr) {\n    var d = new Date(dateStr + 'T12:00:00');\n    return {\n      day: d.toLocaleDateString('en-US', { timeZone: 'America/Toronto', weekday: 'short' }),\n      date: d.toLocaleDateString('en-US', { timeZone: 'America/Toronto', month: 'short', day: 'numeric' })\n    };\n  };\n\n  GOATkitWidget.prototype.formatDuration = function(mins) {\n    if (mins < 60) return mins + ' min';\n    var h = Math.floor(mins / 60);\n    var m = mins % 60;\n    return m ? h + ' hr ' + m + ' min' : h + ' hr';\n  };\n\n  GOATkitWidget.prototype.validatePostalCode = function(code) {\n    return /^[A-Za-z]\\d[A-Za-z]\\s?\\d[A-Za-z]\\d$/.test(code.trim());\n  };\n\n  GOATkitWidget.prototype.normalizePostalCode = function(code) {\n    var clean = code.replace(/\\s/g, '').toUpperCase();\n    if (clean.length === 6) return clean.substring(0, 3) + ' ' + clean.substring(3);\n    return clean;\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STATE & NAVIGATION\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.computeSteps = function() {\n    var steps = ['zip'];\n\n    if (this.state.categories.length > 1) {\n      steps.push('categories');\n    }\n\n    steps.push('services');\n\n    if (this.state.serviceDetail && this.state.serviceDetail.modifiers) {\n      for (var i = 0; i < this.state.serviceDetail.modifiers.length; i++) {\n        steps.push('modifier_' + i);\n      }\n    }\n\n    steps.push('datetime');\n    steps.push('address');\n    steps.push('contact');\n    steps.push('success');\n\n    return steps;\n  };\n\n  GOATkitWidget.prototype.getStepIndex = function() {\n    var steps = this.computeSteps();\n    var idx = steps.indexOf(this.state.currentStep);\n    return idx >= 0 ? idx : 0;\n  };\n\n  GOATkitWidget.prototype.getProgressPercent = function() {\n    var steps = this.computeSteps();\n    var total = steps.length - 1;\n    if (total <= 0) return 0;\n    var idx = steps.indexOf(this.state.currentStep);\n    if (this.state.currentStep === 'success') return 100;\n    return Math.round((idx / (total - 1)) * 100);\n  };\n\n  GOATkitWidget.prototype.goToStep = function(stepId) {\n    this.state.currentStep = stepId;\n    this.state.stepHistory.push(stepId);\n    this.state.error = null;\n    this.onStepChange(stepId, this.getStepIndex());\n    this.render();\n  };\n\n  GOATkitWidget.prototype.goBack = function() {\n    if (this.state.stepHistory.length <= 1) return;\n    this.state.stepHistory.pop();\n    this.state.currentStep = this.state.stepHistory[this.state.stepHistory.length - 1];\n    this.state.error = null;\n    this.render();\n  };\n\n  GOATkitWidget.prototype.getRunningTotal = function() {\n    var svc = this.state.selectedService;\n    if (!svc) return 0;\n    var total = svc.base_price_cents || 0;\n\n    var detail = this.state.serviceDetail;\n    if (detail && detail.modifiers) {\n      for (var i = 0; i < detail.modifiers.length; i++) {\n        var mod = detail.modifiers[i];\n        if (this.state.modifierSelections[mod.id]) {\n          total += (mod.price_adjustment_cents || 0);\n        }\n      }\n    }\n\n    if (this.state.selectedTimeslot && this.state.selectedTimeslot.price) {\n      var priceDiff = this.state.selectedTimeslot.price - (svc.base_price_cents || 0);\n      if (priceDiff !== 0) total += priceDiff;\n    }\n\n    return total;\n  };\n\n  GOATkitWidget.prototype.getEffectiveDuration = function() {\n    var svc = this.state.selectedService;\n    if (!svc) return 0;\n    var dur = svc.base_duration_minutes || 0;\n\n    var detail = this.state.serviceDetail;\n    if (detail && detail.modifiers) {\n      for (var i = 0; i < detail.modifiers.length; i++) {\n        var mod = detail.modifiers[i];\n        if (this.state.modifierSelections[mod.id]) {\n          dur += (mod.duration_adjustment_minutes || 0);\n        }\n      }\n    }\n    return dur;\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // API\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.fetchApi = function(endpoint, options) {\n    var self = this;\n    var headers = { 'Content-Type': 'application/json' };\n    if (this.apiKey) headers['Authorization'] = 'Bearer ' + this.apiKey;\n\n    var controller = typeof AbortController !== 'undefined' ? new AbortController() : null;\n    var timeoutId = controller ? setTimeout(function() { controller.abort(); }, 30000) : null;\n\n    var fetchOpts = Object.assign({}, options || {}, { headers: headers });\n    if (controller) fetchOpts.signal = controller.signal;\n\n    return fetch(this.apiUrl + endpoint, fetchOpts)\n      .then(function(res) {\n        if (timeoutId) clearTimeout(timeoutId);\n        if (!res.ok) {\n          return res.json().catch(function() { return { message: 'Request failed' }; }).then(function(err) {\n            var msg = err.message || (typeof err.error === 'string' ? err.error : null) || 'Request failed';\n            throw new Error(msg);\n          });\n        }\n        return res.json();\n      })\n      .catch(function(err) {\n        if (timeoutId) clearTimeout(timeoutId);\n        if (err.name === 'AbortError') throw new Error('Request timed out');\n        throw err;\n      });\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // RENDER CORE\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.render = function() {\n    var el = document.getElementById(this.containerId);\n    if (!el) return;\n\n    if (this.state.currentStep === 'address' && document.getElementById('zbw-addr1')) {\n      this.readAddressFromDOM();\n    }\n    if (this.state.currentStep === 'contact' && document.getElementById('zbw-fname')) {\n      var fn = document.getElementById('zbw-fname');\n      var ln = document.getElementById('zbw-lname');\n      var em = document.getElementById('zbw-email');\n      var ph = document.getElementById('zbw-phone');\n      if (fn) this.state.contact.firstName = fn.value;\n      if (ln) this.state.contact.lastName = ln.value;\n      if (em) this.state.contact.email = em.value;\n      if (ph) this.state.contact.phone = ph.value;\n    }\n\n    var step = this.state.currentStep;\n    var isSuccess = step === 'success';\n\n    var html = '<div class=\"zbw-root\">';\n\n    if (!isSuccess) {\n      html += this.renderProgress();\n    }\n\n    html += '<div class=\"zbw-layout\">';\n    html += '<div class=\"zbw-main\">';\n\n    if (!isSuccess && this.state.selectedService) {\n      html += this.renderMobileSummary();\n    }\n\n    html += this.renderCurrentStep();\n    html += '</div>';\n\n    if (!isSuccess && this.state.selectedService) {\n      html += '<div class=\"zbw-sidebar\">' + this.renderSidebar() + '</div>';\n    }\n\n    html += '</div></div>';\n\n    el.innerHTML = html;\n\n    var _stepChanged = (this.state.currentStep !== this._prevStep);\n    this._prevStep = this.state.currentStep;\n    if (!_stepChanged) {\n      var _s = el.querySelector('.zbw-step');\n      if (_s) _s.style.animation = 'none';\n    }\n\n    this.attachEvents();\n  };\n\n  GOATkitWidget.prototype.renderProgress = function() {\n    var pct = this.getProgressPercent();\n    var steps = this.computeSteps().filter(function(s) { return s !== 'success'; });\n    var idx = this.getStepIndex();\n    var stepNum = Math.min(idx + 1, steps.length);\n\n    return '<div class=\"zbw-progress\">' +\n      '<div class=\"zbw-progress-bar\"><div class=\"zbw-progress-fill\" style=\"width:' + pct + '%\"></div></div>' +\n      '<div class=\"zbw-progress-text\">Step ' + stepNum + ' of ' + steps.length + '</div>' +\n      '</div>';\n  };\n\n  GOATkitWidget.prototype.renderSidebar = function() {\n    var svc = this.state.selectedService;\n    if (!svc) return '';\n\n    var html = '<div class=\"zbw-summary-panel\">';\n    html += '<div class=\"zbw-summary-title\">Order Summary</div>';\n    html += '<div class=\"zbw-summary-service\">' + this.esc(svc.name) + '</div>';\n\n    html += '<div class=\"zbw-summary-item\"><span>Base price</span><span>' + this.formatPrice(svc.base_price_cents) + '</span></div>';\n\n    var detail = this.state.serviceDetail;\n    if (detail && detail.modifiers) {\n      for (var i = 0; i < detail.modifiers.length; i++) {\n        var mod = detail.modifiers[i];\n        if (this.state.modifierSelections[mod.id]) {\n          html += '<div class=\"zbw-summary-item mod\"><span>' + this.esc(mod.name) + '</span><span>' + this.formatPriceDelta(mod.price_adjustment_cents) + '</span></div>';\n        }\n      }\n    }\n\n    if (this.state.selectedTimeslot) {\n      var ts = this.state.selectedTimeslot;\n      html += '<hr class=\"zbw-summary-divider\">';\n      html += '<div class=\"zbw-summary-detail\">' +\n        '<svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\"/><line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\"/><line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\"/><line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\"/></svg>' +\n        this.formatDate(ts.date) + ' at ' + this.formatTime(ts.start_time) +\n        '</div>';\n    }\n\n    if (this.state.address.line1) {\n      html += '<div class=\"zbw-summary-detail\">' +\n        '<svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z\"/><circle cx=\"12\" cy=\"10\" r=\"3\"/></svg>' +\n        this.esc(this.state.address.line1) +\n        '</div>';\n    }\n\n    html += '<hr class=\"zbw-summary-divider\">';\n    html += '<div class=\"zbw-summary-item\"><span>Duration</span><span>' + this.formatDuration(this.getEffectiveDuration()) + '</span></div>';\n    html += '<div class=\"zbw-summary-total\"><span>Total</span><span>' + this.formatPrice(this.getRunningTotal()) + '</span></div>';\n    html += '</div>';\n    return html;\n  };\n\n  GOATkitWidget.prototype.renderMobileSummary = function() {\n    var total = this.formatPrice(this.getRunningTotal());\n    return '<div class=\"zbw-mobile-summary\">' +\n      '<button class=\"zbw-mobile-summary-btn\" data-action=\"toggleSummary\">' +\n      '<span>View Summary</span><strong>' + total + '</strong>' +\n      '</button>' +\n      (this.state.summaryExpanded ? '<div style=\"margin-top:8px\">' + this.renderSidebar() + '</div>' : '') +\n      '</div>';\n  };\n\n  GOATkitWidget.prototype.renderBackButton = function() {\n    return '<button class=\"zbw-btn-back\" data-action=\"back\">' +\n      '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M19 12H5M12 19l-7-7 7-7\"/></svg>' +\n      'Back</button>';\n  };\n\n  GOATkitWidget.prototype.esc = function(str) {\n    if (!str) return '';\n    var d = document.createElement('div');\n    d.textContent = str;\n    return d.innerHTML;\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP ROUTER\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderCurrentStep = function() {\n    var step = this.state.currentStep;\n    if (step === 'zip') return this.renderZipStep();\n    if (step === 'categories') return this.renderCategoriesStep();\n    if (step === 'services') return this.renderServicesStep();\n    if (step.indexOf('modifier_') === 0) {\n      var idx = parseInt(step.split('_')[1], 10);\n      return this.renderModifierStep(idx);\n    }\n    if (step === 'datetime') return this.renderDateTimeStep();\n    if (step === 'address') return this.renderAddressStep();\n    if (step === 'contact') return this.renderContactStep();\n    if (step === 'success') return this.renderSuccessStep();\n    return '';\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 1: ZIP CODE\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderZipStep = function() {\n    var html = '<div class=\"zbw-step\">';\n    html += '<h2 class=\"zbw-step-title\">Book Online</h2>';\n    html += '<p class=\"zbw-step-desc\">Enter your postal code to check availability in your area.</p>';\n\n    if (this.state.error) {\n      html += '<div class=\"zbw-error\">' + this.esc(this.state.error) + '</div>';\n    }\n\n    html += '<div class=\"zbw-form-group\">';\n    html += '<label for=\"zbw-postal\">Postal Code</label>';\n    html += '<input type=\"text\" id=\"zbw-postal\" class=\"zbw-input\" maxlength=\"7\" placeholder=\"K8N 1A1\" autocomplete=\"postal-code\" autocapitalize=\"characters\" value=\"' + this.esc(this.state.postalCode) + '\" />';\n    html += '</div>';\n\n    html += '<button class=\"zbw-btn zbw-btn-primary\" data-action=\"checkZip\"' + (this.state.loading ? ' disabled' : '') + '>';\n    html += this.state.loading ? 'Checking...' : 'Check Availability';\n    html += '</button>';\n\n    html += '</div>';\n    return html;\n  };\n\n  GOATkitWidget.prototype.handleCheckZip = function() {\n    var input = document.getElementById('zbw-postal');\n    var code = input ? input.value.trim() : '';\n\n    if (!code) {\n      this.state.error = 'Please enter a postal code.';\n      this.render();\n      return;\n    }\n\n    if (!this.validatePostalCode(code)) {\n      this.state.error = 'Please enter a valid Canadian postal code (e.g. K8N 1A1).';\n      this.render();\n      return;\n    }\n\n    var normalized = this.normalizePostalCode(code);\n    this.state.postalCode = normalized;\n    this.state.address.postalCode = normalized;\n    this.state.loading = true;\n    this.state.error = null;\n    this.render();\n\n    var self = this;\n\n    this.fetchApi('/v1/scheduling/service_area_check?postal_code=' + encodeURIComponent(normalized))\n      .then(function(result) {\n        if (result.within_service_area && result.territory) {\n          self.state.territory = result.territory;\n\n          if (result.resolved_city) self.state.address.city = result.resolved_city;\n          if (result.resolved_province) self.state.address.province = result.resolved_province;\n          if (result.resolved_lat && result.resolved_lng) {\n            self.state.postalLat = result.resolved_lat;\n            self.state.postalLng = result.resolved_lng;\n          }\n\n          return self.loadServices();\n        } else {\n          self.state.loading = false;\n          self.state.error = 'Sorry, we don\\u2019t currently service this area.';\n          self.render();\n        }\n      })\n      .catch(function(err) {\n        self.state.loading = false;\n        self.state.error = err.message || 'Something went wrong. Please try again.';\n        self.render();\n        self.onError(err);\n      });\n  };\n\n  GOATkitWidget.prototype.loadServices = function() {\n    var self = this;\n    var tid = this.state.territory.id;\n\n    return this.fetchApi('/v1/services?territory_id=' + tid + '&active=true')\n      .then(function(result) {\n        var services = result.services || result || [];\n        self.state.services = services;\n\n        var catMap = {};\n        for (var i = 0; i < services.length; i++) {\n          var s = services[i];\n          if (s.category_id && s.category_name) {\n            catMap[s.category_id] = s.category_name;\n          }\n        }\n        var cats = [];\n        for (var cid in catMap) {\n          cats.push({ id: cid, name: catMap[cid] });\n        }\n        self.state.categories = cats;\n\n        self.state.loading = false;\n\n        if (cats.length > 1) {\n          self.goToStep('categories');\n        } else {\n          if (cats.length === 1) {\n            self.state.selectedCategory = cats[0].id;\n          }\n          self.goToStep('services');\n        }\n      })\n      .catch(function(err) {\n        self.state.loading = false;\n        self.state.error = err.message;\n        self.render();\n        self.onError(err);\n      });\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 2: CATEGORIES (conditional)\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderCategoriesStep = function() {\n    var html = '<div class=\"zbw-step\">';\n    html += this.renderBackButton();\n    html += '<h2 class=\"zbw-step-title\">What do you need?</h2>';\n    html += '<p class=\"zbw-step-desc\">Select a category to view available services.</p>';\n\n    if (this.state.error) html += '<div class=\"zbw-error\">' + this.esc(this.state.error) + '</div>';\n\n    html += '<div class=\"zbw-cards\">';\n    for (var i = 0; i < this.state.categories.length; i++) {\n      var cat = this.state.categories[i];\n      var sel = this.state.selectedCategory === cat.id ? ' selected' : '';\n      html += '<div class=\"zbw-card' + sel + '\" data-action=\"selectCategory\" data-id=\"' + cat.id + '\">';\n      html += '<div class=\"zbw-card-title\">' + this.esc(cat.name) + '</div>';\n      html += '</div>';\n    }\n    html += '</div>';\n\n    html += '<button class=\"zbw-btn zbw-btn-primary\" data-action=\"confirmCategory\"' + (!this.state.selectedCategory ? ' disabled' : '') + '>Continue</button>';\n    html += '</div>';\n    return html;\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 3: SERVICES\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderServicesStep = function() {\n    var html = '<div class=\"zbw-step\">';\n    html += this.renderBackButton();\n    html += '<h2 class=\"zbw-step-title\">Select a Service</h2>';\n    html += '<p class=\"zbw-step-desc\">Choose from our available services.</p>';\n\n    if (this.state.error) html += '<div class=\"zbw-error\">' + this.esc(this.state.error) + '</div>';\n\n    if (this.state.loading) {\n      html += '<div class=\"zbw-cards\">';\n      for (var k = 0; k < 3; k++) html += '<div class=\"zbw-skeleton zbw-skeleton-card\"></div>';\n      html += '</div>';\n      html += '</div>';\n      return html;\n    }\n\n    var filtered = this.state.services;\n    if (this.state.selectedCategory) {\n      filtered = filtered.filter(function(s) { return s.category_id === this.state.selectedCategory; }.bind(this));\n    }\n\n    html += '<div class=\"zbw-cards\">';\n    for (var i = 0; i < filtered.length; i++) {\n      var svc = filtered[i];\n      var sel = this.state.selectedService && this.state.selectedService.id === svc.id ? ' selected' : '';\n      html += '<div class=\"zbw-card' + sel + '\" data-action=\"selectService\" data-id=\"' + svc.id + '\">';\n      html += '<div class=\"zbw-card-title\">' + this.esc(svc.name) + '</div>';\n      if (svc.description) html += '<div class=\"zbw-card-desc\">' + this.esc(svc.description) + '</div>';\n      html += '<div class=\"zbw-card-meta\">';\n      html += '<span class=\"zbw-card-price\">' + this.formatPrice(svc.base_price_cents) + '</span>';\n      html += '<span class=\"zbw-card-duration\">' + this.formatDuration(svc.base_duration_minutes) + '</span>';\n      html += '</div></div>';\n    }\n    html += '</div>';\n\n    html += '<button class=\"zbw-btn zbw-btn-primary\" data-action=\"confirmService\"' + (!this.state.selectedService ? ' disabled' : '') + '>' + (this.state.loading ? 'Loading...' : 'Continue') + '</button>';\n    html += '</div>';\n    return html;\n  };\n\n  GOATkitWidget.prototype.handleSelectService = function(serviceId) {\n    var svc = this.state.services.find(function(s) { return s.id === serviceId; });\n    if (!svc) return;\n    var hadService = !!this.state.selectedService;\n    this.state.selectedService = svc;\n    this.state.modifierSelections = {};\n    this.state.timeslots = [];\n    this.state.selectedTimeslot = null;\n    this.state.selectedDate = null;\n    if (!hadService) {\n      this.render();\n    } else {\n      this._toggleCards('selectService', serviceId, 'confirmService');\n      this._refreshSidebar();\n    }\n  };\n\n  GOATkitWidget.prototype.handleConfirmService = function() {\n    if (!this.state.selectedService) return;\n    var self = this;\n    this.state.loading = true;\n    this.render();\n\n    this.fetchApi('/v1/services/' + this.state.selectedService.id)\n      .then(function(detail) {\n        self.state.serviceDetail = detail;\n        self.state.loading = false;\n\n        var modifiers = detail.modifiers || [];\n        if (modifiers.length > 0) {\n          self.goToStep('modifier_0');\n        } else {\n          self.goToStep('datetime');\n        }\n      })\n      .catch(function(err) {\n        self.state.loading = false;\n        self.state.error = err.message;\n        self.render();\n      });\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 4: MODIFIERS (1 per screen)\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderModifierStep = function(index) {\n    var detail = this.state.serviceDetail;\n    if (!detail || !detail.modifiers || !detail.modifiers[index]) return '';\n\n    var mod = detail.modifiers[index];\n    var isSelected = !!this.state.modifierSelections[mod.id];\n\n    var html = '<div class=\"zbw-step\">';\n    html += this.renderBackButton();\n    html += '<h2 class=\"zbw-step-title\">' + this.esc(mod.name) + '</h2>';\n    if (mod.description) html += '<p class=\"zbw-step-desc\">' + this.esc(mod.description) + '</p>';\n\n    html += '<div class=\"zbw-modifier-card' + (isSelected ? ' selected' : '') + '\" data-action=\"toggleModifier\" data-id=\"' + mod.id + '\">';\n    html += '<div class=\"zbw-modifier-name\">' + this.esc(mod.name) + '</div>';\n    html += '<div class=\"zbw-modifier-price\">' + this.formatPriceDelta(mod.price_adjustment_cents) + '</div>';\n    if (mod.duration_adjustment_minutes) {\n      html += '<div style=\"font-size:13px;color:#64748b;margin-top:4px\">+' + mod.duration_adjustment_minutes + ' min</div>';\n    }\n    html += '</div>';\n\n    var nextStep;\n    if (index + 1 < detail.modifiers.length) {\n      nextStep = 'modifier_' + (index + 1);\n    } else {\n      nextStep = 'datetime';\n    }\n\n    if (mod.is_required && !isSelected) {\n      html += '<button class=\"zbw-btn zbw-btn-primary\" disabled>Select to continue</button>';\n    } else {\n      html += '<button class=\"zbw-btn zbw-btn-primary\" data-action=\"nextModifier\" data-next=\"' + nextStep + '\">Continue</button>';\n    }\n\n    if (!mod.is_required && !isSelected) {\n      html += '<button class=\"zbw-btn zbw-btn-secondary\" data-action=\"nextModifier\" data-next=\"' + nextStep + '\">Skip</button>';\n    }\n\n    html += '</div>';\n    return html;\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 5: DATE & TIME\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderDateTimeStep = function() {\n    var html = '<div class=\"zbw-step\">';\n    html += this.renderBackButton();\n    html += '<h2 class=\"zbw-step-title\">Choose a Time</h2>';\n    html += '<p class=\"zbw-step-desc\">Select your preferred appointment date and time.</p>';\n\n    if (this.state.error) html += '<div class=\"zbw-error\">' + this.esc(this.state.error) + '</div>';\n\n    if (this.state.loading) {\n      html += '<div class=\"zbw-date-chips\">';\n      for (var k = 0; k < 5; k++) html += '<div class=\"zbw-skeleton zbw-skeleton-chip\"></div>';\n      html += '</div>';\n      html += '<div class=\"zbw-skeleton zbw-skeleton-card\"></div>';\n      html += '<div class=\"zbw-skeleton zbw-skeleton-card\"></div>';\n      html += '</div>';\n      return html;\n    }\n\n    if (this.state.timeslots.length === 0) {\n      this.loadTimeslots();\n      html += '<div style=\"text-align:center;padding:40px;color:#64748b\">Loading available times...</div>';\n      html += '</div>';\n      return html;\n    }\n\n    var allDates = [];\n    var byDate = {};\n    for (var i = 0; i < this.state.timeslots.length; i++) {\n      var t = this.state.timeslots[i];\n      if (!t.available) continue;\n      if (!byDate[t.date]) { byDate[t.date] = []; allDates.push(t.date); }\n      byDate[t.date].push(t);\n    }\n    allDates.sort();\n\n    var ws = this.state.dateWindowStart;\n    var visibleDates = allDates.slice(ws, ws + 7);\n    var selectedDate = this.state.selectedDate || (visibleDates.length > 0 ? visibleDates[0] : null);\n\n    html += '<div class=\"zbw-date-chips\">';\n    html += '<button class=\"zbw-date-nav\" data-action=\"dateNav\" data-dir=\"-1\"' + (ws <= 0 ? ' disabled' : '') + '>&lsaquo;</button>';\n\n    for (var d = 0; d < visibleDates.length; d++) {\n      var ds = this.formatDateShort(visibleDates[d]);\n      var dsel = visibleDates[d] === selectedDate ? ' selected' : '';\n      html += '<div class=\"zbw-date-chip' + dsel + '\" data-action=\"selectDate\" data-date=\"' + visibleDates[d] + '\">';\n      html += '<div class=\"zbw-date-day\">' + ds.day + '</div>';\n      html += '<div class=\"zbw-date-num\">' + ds.date + '</div>';\n      html += '</div>';\n    }\n\n    html += '<button class=\"zbw-date-nav\" data-action=\"dateNav\" data-dir=\"1\"' + (ws + 7 >= allDates.length ? ' disabled' : '') + '>&rsaquo;</button>';\n    html += '</div>';\n\n    var slots = byDate[selectedDate] || [];\n    if (slots.length === 0) {\n      html += '<div style=\"text-align:center;padding:24px;color:#94a3b8;font-size:14px\">No availability on this date.</div>';\n    } else {\n      html += '<div class=\"zbw-timeslots\">';\n      for (var s = 0; s < slots.length; s++) {\n        var sl = slots[s];\n        var ssel = this.state.selectedTimeslot && this.state.selectedTimeslot.date === sl.date && this.state.selectedTimeslot.start_time === sl.start_time ? ' selected' : '';\n        html += '<div class=\"zbw-timeslot' + ssel + '\" data-action=\"selectTimeslot\" data-date=\"' + sl.date + '\" data-time=\"' + sl.start_time + '\" data-price=\"' + (sl.price || 0) + '\">';\n        html += '<div class=\"zbw-timeslot-time\">' + this.formatTime(sl.start_time) + '</div>';\n        if (sl.price) html += '<div class=\"zbw-timeslot-price\">' + this.formatPrice(sl.price) + '</div>';\n        html += '</div>';\n      }\n      html += '</div>';\n    }\n\n    html += '<button class=\"zbw-btn zbw-btn-primary\" data-action=\"confirmDatetime\"' + (!this.state.selectedTimeslot ? ' disabled' : '') + '>Continue</button>';\n    html += '</div>';\n    return html;\n  };\n\n  GOATkitWidget.prototype.loadTimeslots = function() {\n    var self = this;\n    self.state.loading = true;\n    self.render();\n\n    var today = new Date();\n    var dateFrom = today.toISOString().split('T')[0];\n    var end = new Date(today);\n    end.setDate(end.getDate() + 14);\n    var dateTo = end.toISOString().split('T')[0];\n    var dur = this.getEffectiveDuration();\n\n    var params = 'territory_id=' + this.state.territory.id +\n      '&date_from=' + dateFrom +\n      '&date_to=' + dateTo +\n      '&duration_minutes=' + dur +\n      '&service_id=' + this.state.selectedService.id;\n\n    this.fetchApi('/v1/scheduling/timeslots?' + params)\n      .then(function(result) {\n        self.state.timeslots = result.timeslots || [];\n        self.state.loading = false;\n        self.state.selectedDate = null;\n        self.state.selectedTimeslot = null;\n        self.state.dateWindowStart = 0;\n        self.render();\n      })\n      .catch(function(err) {\n        self.state.loading = false;\n        self.state.error = err.message;\n        self.render();\n      });\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 6: ADDRESS\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderAddressStep = function() {\n    var a = this.state.address;\n    var provinces = ['AB','BC','MB','NB','NL','NS','NT','NU','ON','PE','QC','SK','YT'];\n\n    var html = '<div class=\"zbw-step\">';\n    html += this.renderBackButton();\n    html += '<h2 class=\"zbw-step-title\">Service Address</h2>';\n    html += '<p class=\"zbw-step-desc\">Where should we come?</p>';\n\n    if (this.state.error) html += '<div class=\"zbw-error\">' + this.esc(this.state.error) + '</div>';\n\n    html += '<div class=\"zbw-form-group zbw-ac-wrap\"><label>Street Address *</label><input type=\"text\" class=\"zbw-input\" id=\"zbw-addr1\" autocomplete=\"address-line1\" value=\"' + this.esc(a.line1) + '\" placeholder=\"Start typing your address...\" /><div id=\"zbw-ac-list\" class=\"zbw-ac-list\"></div></div>';\n    html += '<div class=\"zbw-form-group\"><label>Apt / Unit</label><input type=\"text\" class=\"zbw-input\" id=\"zbw-addr2\" autocomplete=\"address-line2\" value=\"' + this.esc(a.line2) + '\" /></div>';\n\n    html += '<div class=\"zbw-row\">';\n    html += '<div class=\"zbw-form-group\"><label>City *</label><input type=\"text\" class=\"zbw-input\" id=\"zbw-city\" autocomplete=\"address-level2\" value=\"' + this.esc(a.city) + '\" /></div>';\n    html += '<div class=\"zbw-form-group\"><label>Province *</label><input type=\"text\" class=\"zbw-input\" id=\"zbw-prov\" autocomplete=\"address-level1\" value=\"' + this.esc(a.province) + '\" placeholder=\"ON\" /></div>';\n    html += '</div>';\n\n    html += '<div class=\"zbw-form-group\"><label>Postal Code *</label><input type=\"text\" class=\"zbw-input\" id=\"zbw-postal2\" maxlength=\"7\" autocomplete=\"postal-code\" autocapitalize=\"characters\" value=\"' + this.esc(a.postalCode) + '\" /></div>';\n\n    html += '<button class=\"zbw-btn zbw-btn-primary\" data-action=\"confirmAddress\">Continue</button>';\n    html += '</div>';\n    return html;\n  };\n\n  GOATkitWidget.prototype.readAddressFromDOM = function() {\n    var line1 = (document.getElementById('zbw-addr1') || {}).value;\n    var line2 = (document.getElementById('zbw-addr2') || {}).value;\n    var city = (document.getElementById('zbw-city') || {}).value;\n    var prov = (document.getElementById('zbw-prov') || {}).value;\n    var postal = (document.getElementById('zbw-postal2') || {}).value;\n    if (line1 !== undefined) this.state.address.line1 = line1.trim();\n    if (line2 !== undefined) this.state.address.line2 = line2.trim();\n    if (city !== undefined) this.state.address.city = city.trim();\n    if (prov !== undefined) {\n      var provMap = {'alberta':'AB','british columbia':'BC','manitoba':'MB','new brunswick':'NB','newfoundland and labrador':'NL','nova scotia':'NS','northwest territories':'NT','nunavut':'NU','ontario':'ON','prince edward island':'PE','quebec':'QC','saskatchewan':'SK','yukon':'YT'};\n      var normalized = provMap[prov.toLowerCase().trim()] || prov.trim();\n      this.state.address.province = normalized.length <= 2 ? normalized.toUpperCase() : normalized;\n    }\n    if (postal !== undefined) this.state.address.postalCode = postal.trim();\n  };\n\n  GOATkitWidget.prototype.handleConfirmAddress = function() {\n    this.readAddressFromDOM();\n    var a = this.state.address;\n\n    if (!a.line1 || !a.city || !a.province || !a.postalCode) {\n      this.state.error = 'Please fill in all required fields.';\n      this.render();\n      return;\n    }\n    this.goToStep('contact');\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 7: CONTACT + BOOK\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderContactStep = function() {\n    var c = this.state.contact;\n\n    var html = '<div class=\"zbw-step\">';\n    html += this.renderBackButton();\n    html += '<h2 class=\"zbw-step-title\">Almost Done!</h2>';\n    html += '<p class=\"zbw-step-desc\">Enter your contact info to complete your booking.</p>';\n\n    if (this.state.error) html += '<div class=\"zbw-error\">' + this.esc(this.state.error) + '</div>';\n\n    html += '<div class=\"zbw-row\">';\n    html += '<div class=\"zbw-form-group\"><label>First Name *</label><input type=\"text\" class=\"zbw-input\" id=\"zbw-fname\" autocomplete=\"given-name\" value=\"' + this.esc(c.firstName) + '\" /></div>';\n    html += '<div class=\"zbw-form-group\"><label>Last Name *</label><input type=\"text\" class=\"zbw-input\" id=\"zbw-lname\" autocomplete=\"family-name\" value=\"' + this.esc(c.lastName) + '\" /></div>';\n    html += '</div>';\n    html += '<div class=\"zbw-form-group\"><label>Email *</label><input type=\"email\" class=\"zbw-input\" id=\"zbw-email\" autocomplete=\"email\" inputmode=\"email\" autocapitalize=\"off\" spellcheck=\"false\" value=\"' + this.esc(c.email) + '\" placeholder=\"you@example.com\" /></div>';\n    html += '<div class=\"zbw-form-group\"><label>Phone *</label><input type=\"tel\" class=\"zbw-input\" id=\"zbw-phone\" autocomplete=\"tel\" inputmode=\"tel\" value=\"' + this.esc(c.phone) + '\" placeholder=\"(555) 123-4567\" /></div>';\n\n    html += '<div class=\"zbw-form-group\" style=\"margin-top:8px;\">';\n    html += '<label style=\"display:flex;align-items:flex-start;gap:8px;cursor:pointer;font-size:13px;line-height:1.4;\">';\n    html += '<input type=\"checkbox\" id=\"zbw-sms-consent\"' + (this.state.smsConsent ? ' checked' : '') + ' style=\"margin-top:2px;flex-shrink:0;\" />';\n    html += '<span style=\"color:#666;\">I agree to receive SMS updates about my booking (appointment reminders, status changes). Msg & data rates may apply. Reply STOP to opt out.</span>';\n    html += '</label>';\n    html += '</div>';\n\n    html += '<button class=\"zbw-btn zbw-btn-primary\" data-action=\"submitBooking\"' + (this.state.loading ? ' disabled' : '') + '>' + (this.state.loading ? 'Booking...' : 'Book Now') + '</button>';\n    html += '</div>';\n    return html;\n  };\n\n  GOATkitWidget.prototype.handleSubmitBooking = function() {\n    if (this.state.submitting) return;\n\n    var fn = (document.getElementById('zbw-fname') || {}).value || '';\n    var ln = (document.getElementById('zbw-lname') || {}).value || '';\n    var em = (document.getElementById('zbw-email') || {}).value || '';\n    var ph = (document.getElementById('zbw-phone') || {}).value || '';\n    var smsEl = document.getElementById('zbw-sms-consent');\n    var smsConsent = smsEl ? smsEl.checked : false;\n    this.state.smsConsent = smsConsent;\n\n    this.state.contact = { firstName: fn.trim(), lastName: ln.trim(), email: em.trim(), phone: ph.trim() };\n\n    if (!fn.trim() || !ln.trim() || !em.trim() || !ph.trim()) {\n      this.state.error = 'Please fill in all required fields.';\n      this.render();\n      return;\n    }\n\n    if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(em.trim())) {\n      this.state.error = 'Please enter a valid email address.';\n      this.render();\n      return;\n    }\n\n    this.state.loading = true;\n    this.state.submitting = true;\n    this.state.error = null;\n    this.render();\n\n    var self = this;\n    var svc = this.state.selectedService;\n    var ts = this.state.selectedTimeslot;\n    var a = this.state.address;\n\n    if (!svc || !ts || !ts.date) {\n      this.state.loading = false;\n      this.state.error = 'Please go back and select a service and time.';\n      this.render();\n      return;\n    }\n    if (!a.line1 || !a.city) {\n      this.state.loading = false;\n      this.state.error = 'Please go back and fill in your address.';\n      this.render();\n      return;\n    }\n\n    var selectedModIds = [];\n    if (this.state.serviceDetail && this.state.serviceDetail.modifiers) {\n      for (var i = 0; i < this.state.serviceDetail.modifiers.length; i++) {\n        var mod = this.state.serviceDetail.modifiers[i];\n        if (this.state.modifierSelections[mod.id]) selectedModIds.push(mod.id);\n      }\n    }\n\n    this.fetchApi('/v1/bookings/create', {\n      method: 'POST',\n      body: JSON.stringify({\n        first_name: fn.trim(),\n        last_name: ln.trim(),\n        email: em.trim(),\n        phone: ph.trim() || null,\n        sms_consent: smsConsent,\n        address_line1: a.line1,\n        address_line2: a.line2 || null,\n        city: a.city,\n        province: a.province,\n        postal_code: a.postalCode,\n        territory_id: self.state.territory.id,\n        service_id: svc.id,\n        scheduled_date: ts.date,\n        scheduled_start_time: ts.start_time,\n        duration_minutes: self.getEffectiveDuration(),\n        selected_modifiers: selectedModIds,\n        lat: a.lat || undefined,\n        lng: a.lng || undefined\n      })\n    })\n    .then(function(job) {\n      self.state.jobId = job.id;\n      self.state.loading = false;\n      self.goToStep('success');\n      self.onComplete({ jobId: job.id, service: svc.name, date: ts.date, time: ts.start_time });\n    })\n    .catch(function(err) {\n      self.state.loading = false;\n      self.state.submitting = false;\n      self.state.error = err.message || 'Booking failed. Please try again.';\n      self.render();\n      self.onError(err);\n    });\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // STEP 8: SUCCESS\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.renderSuccessStep = function() {\n    var ts = this.state.selectedTimeslot;\n    var svc = this.state.selectedService;\n    var html = '<div class=\"zbw-success\">';\n    html += '<div class=\"zbw-success-icon\"><svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#16a34a\" stroke-width=\"2.5\"><path d=\"M20 6L9 17l-5-5\"/></svg></div>';\n    html += '<h2>Booking Confirmed!</h2>';\n    html += '<p>Your appointment has been scheduled.</p>';\n    if (svc) html += '<p style=\"font-weight:600;margin-top:12px\">' + this.esc(svc.name) + '</p>';\n    if (ts) html += '<p>' + this.formatDate(ts.date) + ' at ' + this.formatTime(ts.start_time) + '</p>';\n    html += '<p style=\"color:#94a3b8;font-size:13px;margin-top:16px\">Booking ID: ' + (this.state.jobId || '') + '</p>';\n    if (this.state.contact.email) {\n      html += '<p style=\"color:#64748b;font-size:13px\">Confirmation sent to ' + this.esc(this.state.contact.email) + '</p>';\n    }\n    html += '</div>';\n    return html;\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // TARGETED DOM UPDATES (no full re-render)\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype._toggleCards = function(action, selectedId, confirmAction) {\n    var el = document.getElementById(this.containerId);\n    if (!el) return;\n    var cards = el.querySelectorAll('[data-action=\"' + action + '\"]');\n    for (var i = 0; i < cards.length; i++) {\n      if (cards[i].getAttribute('data-id') === selectedId) cards[i].classList.add('selected');\n      else cards[i].classList.remove('selected');\n    }\n    if (confirmAction) {\n      var btn = el.querySelector('[data-action=\"' + confirmAction + '\"]');\n      if (btn) btn.disabled = !selectedId;\n    }\n  };\n\n  GOATkitWidget.prototype._refreshSidebar = function() {\n    var el = document.getElementById(this.containerId);\n    if (!el) return;\n    var sidebar = el.querySelector('.zbw-sidebar');\n    if (sidebar) sidebar.innerHTML = this.renderSidebar();\n    var mBtn = el.querySelector('.zbw-mobile-summary-btn strong');\n    if (mBtn) mBtn.textContent = this.formatPrice(this.getRunningTotal());\n  };\n\n  GOATkitWidget.prototype._renderSlotsForDate = function(date) {\n    var byDate = {};\n    for (var i = 0; i < this.state.timeslots.length; i++) {\n      var t = this.state.timeslots[i];\n      if (!t.available) continue;\n      if (!byDate[t.date]) byDate[t.date] = [];\n      byDate[t.date].push(t);\n    }\n    var slots = byDate[date] || [];\n    if (slots.length === 0) return '<div style=\"text-align:center;padding:24px;color:#94a3b8;font-size:14px\">No availability on this date.</div>';\n    var html = '<div class=\"zbw-timeslots\">';\n    for (var s = 0; s < slots.length; s++) {\n      var sl = slots[s];\n      html += '<div class=\"zbw-timeslot\" data-action=\"selectTimeslot\" data-date=\"' + sl.date + '\" data-time=\"' + sl.start_time + '\" data-price=\"' + (sl.price || 0) + '\">';\n      html += '<div class=\"zbw-timeslot-time\">' + this.formatTime(sl.start_time) + '</div>';\n      if (sl.price) html += '<div class=\"zbw-timeslot-price\">' + this.formatPrice(sl.price) + '</div>';\n      html += '</div>';\n    }\n    html += '</div>';\n    return html;\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // EVENT HANDLING\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  GOATkitWidget.prototype.attachEvents = function() {\n    var self = this;\n    var container = document.getElementById(this.containerId);\n    if (!container) return;\n\n    container.addEventListener('click', function(e) {\n      var target = e.target.closest('[data-action]');\n      if (!target) return;\n      var action = target.getAttribute('data-action');\n\n      switch (action) {\n        case 'checkZip': self.handleCheckZip(); break;\n        case 'back': self.goBack(); break;\n        case 'toggleSummary':\n          self.state.summaryExpanded = !self.state.summaryExpanded;\n          var sumContent = container.querySelector('.zbw-mobile-summary > div:last-child');\n          if (self.state.summaryExpanded && !sumContent) {\n            var wrap = container.querySelector('.zbw-mobile-summary');\n            if (wrap) { var d = document.createElement('div'); d.style.marginTop = '8px'; d.innerHTML = self.renderSidebar(); wrap.appendChild(d); }\n          } else if (!self.state.summaryExpanded && sumContent) {\n            sumContent.remove();\n          }\n          break;\n        case 'selectCategory':\n          self.state.selectedCategory = target.getAttribute('data-id');\n          self.state.selectedService = null;\n          self.state.serviceDetail = null;\n          self.state.modifierSelections = {};\n          self._toggleCards('selectCategory', self.state.selectedCategory, 'confirmCategory');\n          break;\n        case 'confirmCategory':\n          if (self.state.selectedCategory) self.goToStep('services');\n          break;\n        case 'selectService':\n          self.handleSelectService(target.getAttribute('data-id'));\n          break;\n        case 'confirmService':\n          self.handleConfirmService();\n          break;\n        case 'toggleModifier':\n          var mid = target.getAttribute('data-id');\n          self.state.modifierSelections[mid] = !self.state.modifierSelections[mid];\n          self.render();\n          break;\n        case 'nextModifier':\n          var next = target.getAttribute('data-next');\n          self.goToStep(next);\n          break;\n        case 'dateNav':\n          var dir = parseInt(target.getAttribute('data-dir'), 10);\n          self.state.dateWindowStart = Math.max(0, self.state.dateWindowStart + dir * 7);\n          self.render();\n          break;\n        case 'selectDate':\n          self.state.selectedDate = target.getAttribute('data-date');\n          self.state.selectedTimeslot = null;\n          var allChips = container.querySelectorAll('[data-action=\"selectDate\"]');\n          for (var ci = 0; ci < allChips.length; ci++) {\n            if (allChips[ci].getAttribute('data-date') === self.state.selectedDate) allChips[ci].classList.add('selected');\n            else allChips[ci].classList.remove('selected');\n          }\n          var slotsContainer = container.querySelector('.zbw-timeslots') || container.querySelector('[style*=\"text-align:center\"]');\n          if (slotsContainer) {\n            var wrap = slotsContainer.parentNode;\n            var confirmBtn = container.querySelector('[data-action=\"confirmDatetime\"]');\n            slotsContainer.outerHTML = self._renderSlotsForDate(self.state.selectedDate);\n            if (confirmBtn) confirmBtn.disabled = true;\n          }\n          break;\n        case 'selectTimeslot':\n          self.state.selectedTimeslot = {\n            date: target.getAttribute('data-date'),\n            start_time: target.getAttribute('data-time'),\n            price: parseInt(target.getAttribute('data-price'), 10) || 0\n          };\n          var allSlots = container.querySelectorAll('[data-action=\"selectTimeslot\"]');\n          for (var si = 0; si < allSlots.length; si++) {\n            if (allSlots[si] === target) allSlots[si].classList.add('selected');\n            else allSlots[si].classList.remove('selected');\n          }\n          var dtBtn = container.querySelector('[data-action=\"confirmDatetime\"]');\n          if (dtBtn) dtBtn.disabled = false;\n          self._refreshSidebar();\n          break;\n        case 'confirmDatetime':\n          if (self.state.selectedTimeslot) self.goToStep('address');\n          break;\n        case 'confirmAddress':\n          self.handleConfirmAddress();\n          break;\n        case 'submitBooking':\n          self.handleSubmitBooking();\n          break;\n      }\n    });\n\n    var postalInput = container.querySelector('#zbw-postal');\n    if (postalInput) {\n      postalInput.addEventListener('keypress', function(e) {\n        if (e.key === 'Enter') self.handleCheckZip();\n      });\n      postalInput.focus();\n    }\n\n     var addrInput = container.querySelector('#zbw-addr1');\n     if (addrInput) {\n        addrInput.addEventListener('input', function() {\n          var q = addrInput.value.trim();\n          clearTimeout(self._acTimer);\n          if (self._acAbort) { self._acAbort.abort(); self._acAbort = null; }\n          var list = document.getElementById('zbw-ac-list');\n          if (q.length < 3) { if (list) list.innerHTML = ''; return; }\n          self._acTimer = setTimeout(function() {\n            var ctrl = new AbortController();\n            self._acAbort = ctrl;\n            var prox = (self.state.postalLng && self.state.postalLat) ? self.state.postalLng + ',' + self.state.postalLat : 'ip';\n            var base = String(self.apiUrl || '').replace(/[/]+$/, '');\n            var endpoint = base + '/widget/address/search?q=' + encodeURIComponent(q) + '&proximity=' + encodeURIComponent(prox);\n            fetch(endpoint, { signal: ctrl.signal, headers: { 'Accept': 'application/json' } })\n              .then(function(r) {\n                if (!r.ok) throw new Error('Address lookup failed');\n                return r.json();\n              })\n              .then(function(data) {\n                self._acAbort = null;\n                if (!list) return;\n                var features = Array.isArray(data.features) ? data.features : [];\n                if (!features.length) { list.innerHTML = ''; return; }\n                list.innerHTML = features.map(function(f, i) {\n                  var p = f.properties;\n                  var ctx = p.context || {};\n                  return '<div class=\"zbw-ac-item\" data-ac-idx=\"' + i + '\">' +\n                    '<div class=\"zbw-ac-main\">' + (p.name || '') + '</div>' +\n                    '<div class=\"zbw-ac-sub\">' + (ctx.place ? ctx.place.name + ', ' : '') + (ctx.region ? ctx.region.region_code + ' ' : '') + (ctx.postcode ? ctx.postcode.name : '') + '</div>' +\n                    '</div>';\n                }).join('');\n                self._acFeatures = features;\n              })\n              .catch(function(err) {\n                self._acAbort = null;\n                if (err && err.name === 'AbortError') return;\n                if (list) {\n                  list.innerHTML = '<div class=\"zbw-ac-item\" style=\"pointer-events:none;opacity:.8;\"><div class=\"zbw-ac-main\">Address autocomplete unavailable</div><div class=\"zbw-ac-sub\">Please try again in a moment.</div></div>';\n                }\n              });\n          }, 300);\n        });\n\n      addrInput.addEventListener('blur', function() {\n        setTimeout(function() {\n          var list = document.getElementById('zbw-ac-list');\n          if (list) list.innerHTML = '';\n        }, 200);\n      });\n\n      container.addEventListener('click', function(e) {\n        var item = e.target.closest('.zbw-ac-item');\n        if (!item || !self._acFeatures) return;\n        var idx = parseInt(item.getAttribute('data-ac-idx'), 10);\n        var f = self._acFeatures[idx];\n        if (!f) return;\n        var p = f.properties;\n        var ctx = p.context || {};\n        var addr1 = document.getElementById('zbw-addr1');\n        var city = document.getElementById('zbw-city');\n        var prov = document.getElementById('zbw-prov');\n        var postal = document.getElementById('zbw-postal2');\n        if (addr1) addr1.value = p.name || '';\n        if (city) city.value = ctx.place ? ctx.place.name : '';\n        if (prov) prov.value = ctx.region ? ctx.region.region_code : '';\n        if (postal) postal.value = ctx.postcode ? ctx.postcode.name : '';\n        if (f.geometry && f.geometry.coordinates) {\n          self.state.address.lat = f.geometry.coordinates[1];\n          self.state.address.lng = f.geometry.coordinates[0];\n        }\n        self.readAddressFromDOM();\n        var list = document.getElementById('zbw-ac-list');\n        if (list) list.innerHTML = '';\n      });\n    }\n  };\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // EXPOSE\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  window.GOATkitWidget = GOATkitWidget;\n\n  if (typeof window.GOATkitConfig !== 'undefined') {\n    window.goatkitInstance = new GOATkitWidget(window.GOATkitConfig);\n  }\n})();";
export declare const BOOKING_WIDGET_POPUP = "(function() {\n  var API_URL = 'https://api.unclebike.xyz';\n  var PRIMARY_COLOR = '#2563eb';\n  var loaded = false;\n  var overlay = null;\n\n  function getConfig() {\n    return window.GOATkitPopupConfig || {};\n  }\n\n  function createOverlay() {\n    if (overlay) return overlay;\n    var cfg = getConfig();\n    var apiUrl = cfg.apiUrl || API_URL;\n    var color = cfg.primaryColor || PRIMARY_COLOR;\n\n    overlay = document.createElement('div');\n    overlay.id = 'zbw-popup-overlay';\n    overlay.innerHTML = '<div id=\"zbw-popup-backdrop\"></div>' +\n      '<div id=\"zbw-popup-container\">' +\n        '<button id=\"zbw-popup-close\" aria-label=\"Close\">&times;</button>' +\n        '<div id=\"zbw-popup-widget\"></div>' +\n      '</div>';\n\n    var style = document.createElement('style');\n    style.textContent = '#zbw-popup-overlay{position:fixed;inset:0;z-index:99999;display:none;align-items:center;justify-content:center}' +\n      '#zbw-popup-overlay.zbw-open{display:flex}' +\n      '#zbw-popup-backdrop{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);backdrop-filter:blur(2px)}' +\n      '#zbw-popup-container{position:relative;width:94vw;max-width:900px;max-height:min(90dvh,calc(100dvh - 24px));background:#fff;border-radius:16px;box-shadow:0 24px 64px rgba(0,0,0,.2);overflow-y:auto;padding:24px;z-index:1}' +\n      '#zbw-popup-close{position:absolute;top:12px;right:16px;background:none;border:none;font-size:28px;cursor:pointer;color:#64748b;z-index:2;line-height:1;padding:4px 8px;border-radius:8px;transition:background .15s}' +\n      '#zbw-popup-close:hover{background:#f1f5f9;color:#0f172a}' +\n      '@media(max-width:640px){#zbw-popup-container{width:100vw;max-width:100vw;height:100dvh;max-height:100dvh;border-radius:0;padding:calc(16px + env(safe-area-inset-top,0px)) calc(12px + env(safe-area-inset-right,0px)) calc(16px + env(safe-area-inset-bottom,0px)) calc(12px + env(safe-area-inset-left,0px))}}' +\n      '[data-theme=\"dark\"] #zbw-popup-backdrop{background:rgba(17,17,27,.7)}' +\n      '[data-theme=\"dark\"] #zbw-popup-container{background:#1e1e2e;box-shadow:0 24px 64px rgba(0,0,0,.5)}' +\n      '[data-theme=\"dark\"] #zbw-popup-close{color:#a6adc8}' +\n      '[data-theme=\"dark\"] #zbw-popup-close:hover{background:#313244;color:#cdd6f4}';\n    document.head.appendChild(style);\n    document.body.appendChild(overlay);\n\n    overlay.querySelector('#zbw-popup-backdrop').addEventListener('click', closePopup);\n    overlay.querySelector('#zbw-popup-close').addEventListener('click', closePopup);\n\n    if (!loaded) {\n      window.GOATkitConfig = {\n        apiUrl: apiUrl,\n        containerId: 'zbw-popup-widget',\n        primaryColor: color,\n        onComplete: function(booking) {\n          if (cfg.onComplete) cfg.onComplete(booking);\n          setTimeout(closePopup, 2500);\n        },\n        onError: function(err) { if (cfg.onError) cfg.onError(err); },\n        onStepChange: function(step, idx) { if (cfg.onStepChange) cfg.onStepChange(step, idx); }\n      };\n      var s = document.createElement('script');\n      s.src = apiUrl + '/widget/booking-widget.js';\n      document.body.appendChild(s);\n      loaded = true;\n    }\n\n    return overlay;\n  }\n\n  function syncPopupViewport() {\n    if (!overlay) return;\n    var vv = window.visualViewport;\n    var viewportHeight = vv ? vv.height : window.innerHeight;\n    var viewportTop = vv ? vv.offsetTop : 0;\n    var keyboardBottomInset = vv ? Math.max(0, window.innerHeight - (vv.height + vv.offsetTop)) : 0;\n    overlay.style.top = viewportTop + 'px';\n    overlay.style.bottom = keyboardBottomInset + 'px';\n    var container = overlay.querySelector('#zbw-popup-container');\n    if (container) {\n      var h = Math.max(260, Math.floor(viewportHeight - 24));\n      container.style.maxHeight = h + 'px';\n    }\n  }\n\n  function openPopup() {\n    var el = createOverlay();\n    el.classList.add('zbw-open');\n    document.body.style.overflow = 'hidden';\n    syncPopupViewport();\n    if (window.visualViewport) {\n      window.visualViewport.addEventListener('resize', syncPopupViewport);\n      window.visualViewport.addEventListener('scroll', syncPopupViewport);\n    }\n    window.addEventListener('orientationchange', syncPopupViewport);\n\n    if (window.goatkitInstance) {\n      window.goatkitInstance.state.currentStep = 'zip';\n      window.goatkitInstance.state.stepHistory = ['zip'];\n      window.goatkitInstance.state.error = null;\n      window.goatkitInstance.state.loading = false;\n      window.goatkitInstance.state.submitting = false;\n      window.goatkitInstance.render();\n    }\n  }\n\n  function closePopup() {\n    if (overlay) {\n      overlay.classList.remove('zbw-open');\n      document.body.style.overflow = '';\n      overlay.style.top = '';\n      overlay.style.bottom = '';\n      if (window.visualViewport) {\n        window.visualViewport.removeEventListener('resize', syncPopupViewport);\n        window.visualViewport.removeEventListener('scroll', syncPopupViewport);\n      }\n      window.removeEventListener('orientationchange', syncPopupViewport);\n    }\n  }\n\n  document.addEventListener('keydown', function(e) {\n    if (e.key === 'Escape') closePopup();\n  });\n\n  document.addEventListener('click', function(e) {\n    var el = e.target.closest('[data-zbw-open], .zbw-book-btn');\n    if (el) { e.preventDefault(); openPopup(); }\n  });\n\n  window.GOATkitPopup = { open: openPopup, close: closePopup };\n\n  var cfg = getConfig();\n  if (cfg.floatingButton !== false) {\n    var ready = function() {\n      var btn = document.createElement('button');\n      btn.id = 'zbw-floating-btn';\n      btn.innerHTML = '<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/><line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\"/><line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\"/><line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\"/></svg> ' + (cfg.floatingButtonText || 'Book Now');\n      var color = cfg.primaryColor || PRIMARY_COLOR;\n      var s = document.createElement('style');\n      s.textContent = '#zbw-floating-btn{position:fixed;bottom:24px;right:24px;z-index:9999;background:' + color + ';color:#fff;border:none;padding:14px 24px;border-radius:50px;font-size:15px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;box-shadow:0 4px 16px rgba(0,0,0,.2);transition:transform .15s,box-shadow .15s}' +\n        '#zbw-floating-btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,.25)}' +\n        '#zbw-floating-btn svg{flex-shrink:0}' +\n        '@media(max-width:640px){#zbw-floating-btn{bottom:16px;right:16px;padding:12px 20px;font-size:14px}}' +\n        '[data-theme=\"dark\"] #zbw-floating-btn{box-shadow:0 4px 16px rgba(0,0,0,.4)}' +\n        '[data-theme=\"dark\"] #zbw-floating-btn:hover{box-shadow:0 6px 24px rgba(0,0,0,.5)}';\n      document.head.appendChild(s);\n      document.body.appendChild(btn);\n      btn.addEventListener('click', openPopup);\n    };\n    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', ready);\n    else ready();\n  }\n})();";
export declare const BOOKING_WIDGET_DEMO = "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content\">\n  <title>Booking Widget Demo</title>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f1f5f9; min-height: 100vh; min-height: 100dvh; display: flex; flex-direction: column; align-items: center; padding: 40px 20px; }\n    .demo-header { text-align: center; margin-bottom: 32px; }\n    .demo-header h1 { font-size: 28px; color: #0f172a; margin-bottom: 8px; }\n    .demo-header p { color: #64748b; font-size: 15px; }\n    #goatkit-widget { width: 100%; max-width: 900px; background: #fff; border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,.08); padding: 32px; }\n    .demo-code { max-width: 900px; width: 100%; margin-top: 40px; background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,.04); }\n    .demo-code h3 { font-size: 16px; margin-bottom: 12px; color: #0f172a; }\n    .demo-code pre { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; overflow-x: auto; font-size: 13px; line-height: 1.6; }\n  </style>\n</head>\n<body>\n  <div class=\"demo-header\">\n    <h1>Booking Widget</h1>\n    <p>Embeddable booking widget for your website</p>\n  </div>\n\n  <div id=\"goatkit-widget\"></div>\n\n  <div class=\"demo-code\">\n    <h3>Embed on Your Site</h3>\n    <pre><code>&lt;div id=\"goatkit-widget\"&gt;&lt;/div&gt;\n\n&lt;script&gt;\n  window.GOATkitConfig = {\n    apiUrl: 'https://api.unclebike.xyz',\n    containerId: 'goatkit-widget',\n    primaryColor: '#2563eb',\n    onComplete: function(booking) {\n      console.log('Booked:', booking);\n    }\n  };\n&lt;/script&gt;\n&lt;script src=\"https://api.unclebike.xyz/widget/booking-widget.js\"&gt;&lt;/script&gt;</code></pre>\n  </div>\n\n  <script>\n    window.GOATkitConfig = {\n      apiUrl: window.location.origin,\n      containerId: 'goatkit-widget',\n      primaryColor: '#2563eb',\n      onComplete: function(booking) {\n        console.log('Booking completed:', booking);\n      },\n      onError: function(error) {\n        console.error('Booking error:', error);\n      },\n      onStepChange: function(step, index) {\n        console.log('Step:', step, 'Index:', index);\n      }\n    };\n  </script>\n  <script src=\"/widget/booking-widget.js\"></script>\n</body>\n</html>";
//# sourceMappingURL=embed.d.ts.map