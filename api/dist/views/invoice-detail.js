import { jsxs as _jsxs, jsx as _jsx } from "hono/jsx/jsx-runtime";
import { StatusIcon } from './components';
import { Layout } from './layout';
const money = (cents) => `$${(cents / 100).toFixed(2)}`;
export const InvoiceDetailPage = ({ invoice, customers, jobs, lineItems, }) => {
    const subtotal = lineItems.reduce((sum, line) => sum + line.total_cents, 0);
    const total = Math.max(0, subtotal + Number(invoice.tax_cents || 0) - Number(invoice.discount_cents || 0));
    const customerName = (() => {
        const c = customers.find(cu => cu.id === invoice.customer_id);
        return c ? `${c.first_name} ${c.last_name}`.trim() : 'Customer';
    })();
    const jobLabel = (() => {
        if (!invoice.job_id)
            return null;
        const j = jobs.find(jb => jb.id === invoice.job_id);
        return j ? `${j.customer_name} - ${j.scheduled_date}` : 'Linked job';
    })();
    return (_jsxs(Layout, { title: `Invoice ${invoice.invoice_number}`, children: [_jsxs("div", { class: "page-header page-header--rich", children: [_jsxs("div", { class: "page-header-info", children: [_jsxs("div", { class: "flex items-center gap-2", children: [_jsxs("h2", { children: ["Invoice ", invoice.invoice_number] }), _jsx(StatusIcon, { status: invoice.status })] }), _jsxs("div", { class: "page-header-meta", children: [_jsx("span", { children: customerName }), jobLabel && _jsx("span", { children: jobLabel }), invoice.due_date && _jsxs("span", { children: ["Due ", invoice.due_date] })] })] }), _jsxs("div", { class: "page-header-actions", children: [_jsx("button", { type: "submit", form: "invoice-form", class: "uk-btn uk-btn-primary uk-btn-sm", children: "Save" }), _jsx("a", { href: "/admin/invoices", class: "uk-btn uk-btn-default uk-btn-sm", "hx-get": "/admin/invoices", "hx-target": "#page-content", "hx-select": "#page-content", "hx-push-url": "true", children: "Back" })] })] }), _jsx("div", { class: "p-4 sm:p-8", style: "padding-bottom: calc(40px + var(--safe-bottom));", children: _jsx("div", { children: _jsx("div", { class: "mx-auto", style: "max-width: 1120px;", children: _jsxs("div", { class: "grid gap-4 lg:grid-cols-[1fr,360px] lg:gap-6", children: [_jsxs("div", { class: "grid gap-4", children: [_jsxs("div", { class: "uk-card uk-card-body", style: "background:var(--surface-0);", children: [_jsxs("div", { class: "flex items-start justify-between gap-3", children: [_jsxs("div", { class: "min-w-0", children: [_jsx("p", { class: "text-[10px] uppercase tracking-wide text-muted-foreground", children: "Amount due" }), _jsx("p", { class: "text-3xl font-extrabold", style: "margin:0;", children: money(total) }), _jsxs("p", { class: "text-xs text-muted-foreground", style: "margin:6px 0 0;", children: ["Subtotal ", money(subtotal), " \u2022 Tax ", money(Number(invoice.tax_cents || 0)), " \u2022 Discount ", money(Number(invoice.discount_cents || 0))] })] }), _jsxs("div", { class: "text-right", children: [_jsx("p", { class: "text-[10px] uppercase tracking-wide text-muted-foreground", children: "Status" }), _jsx(StatusIcon, { status: invoice.status }), invoice.due_date ? (_jsxs("p", { class: "text-xs text-muted-foreground", style: "margin:8px 0 0;", children: ["Due ", invoice.due_date] })) : null] })] }), _jsx("input", { type: "hidden", id: "total_amount", name: "total_amount", form: "invoice-form", value: (total / 100).toFixed(2) })] }), _jsxs("div", { class: "uk-card uk-card-body", children: [_jsxs("div", { class: "flex items-center justify-between mb-4", children: [_jsx("h3", { class: "text-base font-semibold", style: "margin:0;", children: "Line items" }), _jsx("span", { class: "text-sm font-semibold", children: money(subtotal) })] }), _jsx("div", { class: "grid gap-2 mb-4", children: lineItems.length === 0 ? (_jsx("p", { class: "text-sm text-muted-foreground", children: "No line items." })) : (lineItems.map((line) => (_jsxs("div", { class: "flex items-start gap-3 p-3 border border-border rounded-md", children: [_jsxs("div", { class: "flex-1 min-w-0", style: line.parent_id ? 'padding-left:16px;' : '', children: [_jsx("p", { class: "text-sm font-medium", style: "margin:0;", children: line.description }), _jsxs("p", { class: "text-xs text-muted-foreground", style: "margin:4px 0 0;", children: [line.kind, " \u2022 ", line.quantity, " x ", money(line.unit_price_cents)] })] }), _jsxs("div", { class: "text-right", children: [_jsx("p", { class: "text-sm font-semibold", style: "margin:0;", children: money(line.total_cents) }), line.is_custom ? (_jsx("button", { type: "button", class: "delete-btn uk-btn uk-btn-small", "hx-post": `/admin/invoices/${invoice.id}/line-items/delete`, "hx-vals": JSON.stringify({ lineId: line.id }), "hx-target": "#page-content", "hx-select": "#page-content", "data-confirm": "arm", children: "Remove" })) : null] })] }, line.id)))) }), _jsxs("form", { "hx-post": `/admin/invoices/${invoice.id}/line-items/add`, "hx-target": "#page-content", "hx-select": "#page-content", class: "grid gap-2 sm:grid-cols-4", children: [_jsx("input", { type: "text", name: "description", class: "uk-input sm:col-span-2", placeholder: "Custom line description", required: true }), _jsx("input", { type: "number", name: "quantity", class: "uk-input", min: 1, step: 1, value: "1", required: true }), _jsx("input", { type: "number", name: "unit_price", class: "uk-input", min: 0, step: 0.01, placeholder: "Unit price", required: true }), _jsx("div", { class: "sm:col-span-4 flex justify-end", children: _jsx("button", { type: "submit", class: "uk-btn uk-btn-default", children: "Add Custom Line" }) })] })] })] }), _jsxs("aside", { class: "grid gap-4 lg:sticky", style: "top: 92px;", children: [_jsxs("details", { class: "uk-card uk-card-body", open: true, children: [_jsx("summary", { class: "text-base font-semibold cursor-pointer", children: "Invoice details" }), _jsxs("form", { id: "invoice-form", "hx-post": `/admin/invoices/${invoice.id}`, "hx-target": "#page-content", "hx-select": "#page-content", "hx-push-url": "/admin/invoices", class: "pt-4 grid gap-4", children: [_jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "invoice_number", children: "Invoice Number" }), _jsx("input", { id: "invoice_number", name: "invoice_number", class: "uk-input", value: invoice.invoice_number, required: true })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "currency", children: "Currency" }), _jsxs("select", { id: "currency", name: "currency", class: "uk-select", required: true, children: [_jsx("option", { value: "CAD", selected: invoice.currency === 'CAD', children: "CAD" }), _jsx("option", { value: "USD", selected: invoice.currency === 'USD', children: "USD" })] })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "customer_id", children: "Customer" }), _jsx("select", { id: "customer_id", name: "customer_id", class: "uk-select", required: true, children: customers.map((customer) => (_jsxs("option", { value: customer.id, selected: customer.id === invoice.customer_id, children: [customer.first_name, " ", customer.last_name] }, customer.id))) })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "job_id", children: "Job" }), _jsxs("select", { id: "job_id", name: "job_id", class: "uk-select", children: [_jsx("option", { value: "", children: "None" }), jobs.map((job) => (_jsxs("option", { value: job.id, selected: invoice.job_id === job.id, children: [job.customer_name, " - ", job.scheduled_date] }, job.id)))] })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "due_date", children: "Due Date" }), _jsx("input", { id: "due_date", name: "due_date", type: "date", class: "uk-input", value: invoice.due_date || '' })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "status", children: "Status" }), _jsxs("select", { id: "status", name: "status", class: "uk-select", required: true, children: [_jsx("option", { value: "pending", selected: invoice.status === 'pending', children: "Pending" }), _jsx("option", { value: "sent", selected: invoice.status === 'sent', children: "Sent" }), _jsx("option", { value: "paid", selected: invoice.status === 'paid', children: "Paid" }), _jsx("option", { value: "void", selected: invoice.status === 'void', children: "Void" })] })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "tax_amount", children: "Tax ($)" }), _jsx("input", { id: "tax_amount", name: "tax_amount", type: "number", class: "uk-input", step: 0.01, min: 0, value: (invoice.tax_cents / 100).toFixed(2) })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "discount_amount", children: "Discount ($)" }), _jsx("input", { id: "discount_amount", name: "discount_amount", type: "number", class: "uk-input", step: 0.01, min: 0, value: (invoice.discount_cents / 100).toFixed(2) })] }), _jsxs("div", { class: "grid gap-2", children: [_jsx("label", { class: "uk-form-label", for: "notes", children: "Notes" }), _jsx("textarea", { id: "notes", name: "notes", rows: 4, class: "uk-textarea", children: invoice.notes || '' })] })] })] }), _jsxs("details", { class: "uk-card uk-card-body danger-card", children: [_jsx("summary", { class: "text-base font-semibold cursor-pointer", children: "Danger zone" }), _jsx("div", { class: "pt-4", children: _jsx("button", { type: "button", class: "delete-btn", "hx-post": `/admin/invoices/${invoice.id}/delete`, "hx-target": "#page-content", "data-confirm": "arm", children: "Delete invoice" }) })] })] })] }) }) }) })] }));
};
//# sourceMappingURL=invoice-detail.js.map