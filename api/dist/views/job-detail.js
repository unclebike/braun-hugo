import { jsx as _jsx, jsxs as _jsxs } from "hono/jsx/jsx-runtime";
import { Layout } from './layout';
const STATUS_OPTIONS = ['created', 'assigned', 'enroute', 'in_progress', 'complete', 'cancelled'];
const TaskSourceContext = ({ source }) => {
    if (!source || source.type !== 'sms' || !source.excerpt)
        return null;
    return (_jsxs("details", { class: "mt-1.5 border-l-2 border-border pl-3 ml-1", children: [_jsx("summary", { class: "text-[10px] uppercase tracking-wider text-muted-foreground cursor-pointer hover:text-foreground transition-colors", children: "View Context" }), _jsxs("div", { class: "mt-2 text-xs italic text-muted-foreground line-clamp-3 overflow-hidden", children: ["\"", source.excerpt, "\""] }), source.message_id && (_jsx("a", { href: `/admin/inbox/${source.message_id}`, class: "uk-link text-[10px] uppercase font-bold mt-1.5 inline-block", "hx-get": `/admin/inbox/${source.message_id}`, "hx-target": "#page-content", "hx-select": "#page-content", "hx-push-url": "true", children: "Open thread \u2192" }))] }));
};
export const NotesList = ({ jobId, notes, listId = 'notes-list', }) => (_jsx("div", { id: listId, "data-notes-list": "1", class: "grid gap-3", children: notes.length === 0 ? (_jsx("div", { class: "py-8 text-center border-2 border-dashed border-border rounded-xl", children: _jsx("p", { class: "text-sm text-muted-foreground", children: "No tasks or notes assigned to this job." }) })) : (notes.map((note, idx) => (_jsxs("div", { class: `group relative flex items-start gap-4 p-4 rounded-xl border border-border bg-card transition-all ${note.completed ? 'opacity-60 grayscale-[0.5]' : 'hover:border-brand/50'}`, children: [_jsx("div", { class: "pt-0.5", children: _jsx("input", { type: "checkbox", class: "uk-checkbox w-5 h-5 rounded-md border-2", checked: note.completed ? true : undefined, "hx-post": `/admin/jobs/${jobId}/notes/toggle`, "hx-vals": JSON.stringify({ noteIndex: idx }), "hx-target": "closest [data-notes-list]", "hx-select": `#${listId} > *`, "hx-swap": "innerHTML" }) }), _jsxs("div", { class: "flex-1 min-w-0", children: [_jsx("p", { class: `text-[15px] leading-relaxed font-medium ${note.completed ? 'line-through text-muted-foreground' : 'text-foreground'}`, children: note.text }), _jsxs("div", { class: "flex items-center gap-3 mt-2", children: [_jsx("span", { class: "text-[11px] font-semibold text-muted-foreground/70 uppercase tracking-tight", children: new Date(note.timestamp).toLocaleDateString('en-CA', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) }), note.source?.type === 'sms' && _jsx("span", { class: "uk-label uk-label-secondary text-[9px] px-1.5 py-0.5", children: "SMS" })] }), _jsx(TaskSourceContext, { source: note.source })] }), _jsx("button", { type: "button", class: "opacity-0 group-hover:opacity-100 transition-opacity p-1.5 -mr-1 hover:text-destructive text-muted-foreground", "hx-post": `/admin/jobs/${jobId}/notes/delete`, "hx-vals": JSON.stringify({ noteIndex: idx }), "hx-target": "closest [data-notes-list]", "hx-select": `#${listId} > *`, "hx-swap": "innerHTML", "data-confirm": "arm", title: "Delete task", children: _jsxs("svg", { width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", "stroke-width": "2.5", "stroke-linecap": "round", "stroke-linejoin": "round", children: [_jsx("title", { children: "Delete task" }), _jsx("path", { d: "M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" })] }) })] }, idx)))) }));
export const SmsThreadCard = ({ jobId, smsThreadMessage, customerName }) => {
    const hasUnread = !!smsThreadMessage && smsThreadMessage.is_read === 0;
    const updatedLabel = smsThreadMessage
        ? new Date(`${smsThreadMessage.updated_at}Z`).toLocaleString('en-CA', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })
        : null;
    return (_jsxs("div", { id: "job-sms-thread-card", class: `uk-card uk-card-body border-2 ${hasUnread ? 'border-destructive shadow-lg shadow-destructive/5' : 'border-border shadow-sm'}`, "hx-get": `/admin/jobs/${jobId}/sms-thread-card`, "hx-trigger": "every 15s", "hx-swap": "outerHTML", children: [_jsxs("div", { class: "flex items-center justify-between mb-4", children: [_jsxs("div", { class: "flex items-center gap-3", children: [_jsx("div", { class: `w-10 h-10 rounded-full flex items-center justify-center ${hasUnread ? 'bg-destructive text-white animate-pulse' : 'bg-muted text-muted-foreground'}`, children: _jsxs("svg", { width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", "stroke-width": "2", children: [_jsx("title", { children: "SMS Message" }), _jsx("path", { d: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" })] }) }), _jsxs("div", { children: [_jsx("h3", { class: "text-base font-bold leading-none", children: "Conversation" }), _jsx("p", { class: "text-[11px] text-muted-foreground mt-1 uppercase font-semibold tracking-wider", children: "SMS Thread" })] })] }), hasUnread && (_jsx("span", { class: "uk-label uk-label-destructive px-3 py-1 font-bold", children: "New Message" }))] }), smsThreadMessage ? (_jsxs("div", { class: "grid gap-4", children: [_jsxs("div", { class: "bg-muted/40 p-4 rounded-xl border border-border/50", children: [_jsx("p", { class: "text-sm leading-relaxed text-foreground italic", children: smsThreadMessage.body ? `"${smsThreadMessage.body}"` : 'Conversation linked.' }), _jsx("p", { class: "text-[10px] text-muted-foreground mt-3 font-medium uppercase tracking-widest", children: updatedLabel ? `Last updated ${updatedLabel}` : '' })] }), _jsx("button", { type: "button", class: "uk-btn uk-btn-primary w-full py-2.5 font-bold shadow-md shadow-brand/10", "data-sms-thread-modal-open": "true", "data-sms-thread-modal-title": customerName || '', "hx-get": `/admin/inbox/${smsThreadMessage.id}/sms-thread-panel`, "hx-target": "#sms-thread-modal-body", "hx-swap": "innerHTML", "hx-indicator": "#sms-thread-modal-loading", children: "Open Chat Interface" })] })) : (_jsx("div", { class: "py-6 text-center", children: _jsx("p", { class: "text-sm text-muted-foreground", children: "No active conversation linked to this job." }) }))] }));
};
const money = (cents) => `$${(cents / 100).toFixed(2)}`;
export const JobDetailPage = ({ job, customer, service, territory, team, assignedProviderId, notes, smsThreadMessage, lineItems }) => {
    const subtotal = lineItems.reduce((sum, line) => sum + line.total_cents, 0);
    const customerName = customer ? `${customer.first_name} ${customer.last_name}`.trim() : 'Unassigned customer';
    const serviceName = service?.name || job.custom_service_name || 'Custom Service';
    const providerName = assignedProviderId
        ? (() => {
            const p = team.find(t => t.id === assignedProviderId);
            return p ? `${p.first_name} ${p.last_name}`.trim() : 'Assigned';
        })()
        : 'Unassigned';
    const dateLabel = (() => {
        try {
            const d = new Date(`${job.scheduled_date}T00:00:00`);
            return d.toLocaleDateString('en-CA', { weekday: 'short', month: 'short', day: 'numeric' });
        }
        catch {
            return job.scheduled_date;
        }
    })();
    const timeLabel = job.scheduled_start_time ? job.scheduled_start_time : '';
    const canOpenSms = Boolean(smsThreadMessage);
    const smsTitle = customer ? `${customer.first_name} ${customer.last_name}`.trim() : '';
    const actualDuration = job.started_at && job.completed_at
        ? Math.round((new Date(`${job.completed_at}Z`).getTime() - new Date(`${job.started_at}Z`).getTime()) / 60000)
        : null;
    return (_jsxs(Layout, { title: `${customerName} - ${serviceName}`, children: [_jsxs("div", { class: "page-header page-header--rich bg-card border-b border-border sticky top-0 z-[100] shadow-sm", children: [_jsx("div", { class: "page-header-info min-w-0", children: _jsxs("div", { class: "flex items-center gap-3 sm:gap-4", children: [_jsxs("div", { class: "avatar bg-brand/10 text-brand font-black w-10 h-10 sm:w-12 sm:h-12 text-sm sm:text-lg rounded-xl sm:rounded-2xl flex items-center justify-center shrink-0", children: [customer?.first_name?.[0], customer?.last_name?.[0]] }), _jsxs("div", { class: "min-w-0", children: [_jsx("h2", { class: "text-lg sm:text-2xl font-black tracking-tight leading-tight truncate", children: customerName }), _jsxs("div", { class: "flex items-center gap-1.5 sm:gap-2 mt-1 sm:mt-2 overflow-hidden", children: [_jsx("span", { class: "text-[11px] sm:text-sm font-bold text-muted-foreground truncate", children: serviceName }), _jsx("span", { class: "w-1 h-1 rounded-full bg-border shrink-0" }), _jsx("span", { class: "text-[11px] sm:text-sm font-bold text-muted-foreground truncate", children: territory?.name || 'No Territory' })] })] })] }) }), _jsxs("div", { class: "page-header-actions gap-2 sm:gap-3 flex-nowrap", children: [_jsxs("div", { class: "hidden md:flex flex-col items-end text-right mr-2", children: [_jsx("span", { class: "text-[9px] uppercase font-black text-muted-foreground tracking-widest leading-none mb-1", children: "Status" }), _jsx("select", { name: "status", class: "status-select font-bold py-1 px-3 text-[10px] h-7", "data-current": job.status, "hx-post": `/admin/jobs/${job.id}/status`, "hx-target": "#page-content", "hx-select": "#page-content", "hx-trigger": "change", children: STATUS_OPTIONS.map((status) => (_jsx("option", { value: status, selected: job.status === status, children: status.replace('_', ' ').toUpperCase() }, status))) })] }), _jsx("button", { type: "button", class: "uk-btn uk-btn-primary uk-btn-sm font-black h-9 sm:h-10 px-3 sm:px-6 rounded-lg sm:rounded-xl shadow-md sm:shadow-lg shadow-brand/20 transition-all hover:scale-[1.02] text-xs sm:text-sm", "data-sms-thread-modal-open": canOpenSms ? 'true' : undefined, "data-sms-thread-modal-title": canOpenSms ? smsTitle : undefined, "hx-get": canOpenSms ? `/admin/inbox/${smsThreadMessage?.id}/sms-thread-panel` : undefined, "hx-target": canOpenSms ? '#sms-thread-modal-body' : undefined, "hx-swap": canOpenSms ? 'innerHTML' : undefined, "hx-indicator": canOpenSms ? '#sms-thread-modal-loading' : undefined, disabled: !canOpenSms, children: "Message" }), _jsx("a", { href: "/admin/jobs", class: "uk-btn uk-btn-default uk-btn-sm h-9 w-9 sm:h-10 sm:w-10 p-0 rounded-lg sm:rounded-xl flex items-center justify-center border-2 border-border hover:bg-muted shrink-0", "hx-get": "/admin/jobs", "hx-target": "#page-content", "hx-select": "#page-content", "hx-push-url": "true", children: _jsxs("svg", { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", "stroke-width": "2.5", class: "sm:w-5 sm:h-5", children: [_jsx("title", { children: "Back to Jobs" }), _jsx("path", { d: "M19 12H5m7 7-7-7 7-7" })] }) })] })] }), _jsx("div", { class: "p-4 lg:p-8", children: _jsxs("div", { class: "mx-auto max-w-[1400px]", children: [_jsxs("div", { class: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-8", children: [_jsxs("div", { class: "bg-card border border-border p-5 rounded-2xl shadow-sm", children: [_jsx("p", { class: "text-[10px] uppercase font-black text-muted-foreground tracking-widest mb-1.5", children: "Job Identifier" }), _jsxs("p", { class: "text-xl font-bold font-mono", children: ["#", job.id.slice(0, 8).toUpperCase()] })] }), _jsxs("div", { class: "bg-card border border-border p-5 rounded-2xl shadow-sm", children: [_jsx("p", { class: "text-[10px] uppercase font-black text-muted-foreground tracking-widest mb-1.5", children: "Scheduled For" }), _jsx("p", { class: "text-xl font-bold text-foreground", children: dateLabel }), _jsx("p", { class: "text-sm font-bold text-muted-foreground mt-0.5", children: timeLabel || 'TBD' })] }), _jsxs("div", { class: "bg-card border border-border p-5 rounded-2xl shadow-sm", children: [_jsx("p", { class: "text-[10px] uppercase font-black text-muted-foreground tracking-widest mb-1.5", children: "Assigned Provider" }), _jsx("p", { class: "text-xl font-bold text-foreground truncate", children: providerName }), _jsxs("p", { class: "text-sm font-bold text-muted-foreground mt-0.5", children: [job.duration_minutes, " min duration"] })] }), _jsxs("div", { class: "bg-brand border border-brand p-5 rounded-2xl shadow-md shadow-brand/10", children: [_jsx("p", { class: "text-[10px] uppercase font-black text-on-brand/70 tracking-widest mb-1.5", children: "Total Revenue" }), _jsx("p", { class: "text-2xl font-black text-on-brand", children: money(job.total_price_cents) }), _jsxs("p", { class: "text-[11px] font-bold text-on-brand/80 mt-0.5", children: [lineItems.length, " Billing Items"] })] })] }), _jsxs("div", { class: "grid gap-8 lg:grid-cols-[1fr,380px]", children: [_jsxs("div", { class: "grid gap-8 content-start", children: [_jsxs("section", { id: "tasks", children: [_jsxs("div", { class: "flex items-center justify-between mb-6", children: [_jsxs("div", { class: "flex items-center gap-3", children: [_jsx("div", { class: "w-2 h-8 bg-brand rounded-full" }), _jsx("h3", { class: "text-xl font-black tracking-tight", children: "Active Tasks & Notes" })] }), _jsx("span", { class: "uk-badge bg-muted text-muted-foreground font-bold px-3 py-1.5 rounded-lg border border-border/50 shadow-sm", children: notes.length })] }), _jsx("div", { class: "mb-6", children: _jsx(NotesList, { jobId: job.id, notes: notes, listId: "notes-main-list" }) }), _jsx("div", { class: "bg-card border-2 border-border p-2 rounded-2xl shadow-sm focus-within:border-brand transition-colors", children: _jsxs("form", { "hx-post": `/admin/jobs/${job.id}/notes/add`, "hx-target": "#notes-main-list", "hx-select": "#notes-main-list > *", "hx-swap": "innerHTML", "hx-on": "htmx:afterRequest: const xhr=event.detail.xhr; if(!xhr||xhr.status<200||xhr.status>=300) return; this.querySelector('input').value='';", class: "flex gap-2", children: [_jsx("input", { type: "text", name: "text", class: "uk-input border-0 focus:ring-0 bg-transparent text-base font-medium placeholder:text-muted-foreground/50 h-12 px-4 flex-1", placeholder: "Type a new task and press enter...", required: true }), _jsx("button", { type: "submit", class: "uk-btn uk-btn-primary px-8 rounded-xl font-black shadow-md", children: "Add Task" })] }) })] }), _jsxs("section", { id: "logistics", children: [_jsxs("div", { class: "flex items-center gap-3 mb-6", children: [_jsx("div", { class: "w-2 h-8 bg-muted-foreground rounded-full" }), _jsx("h3", { class: "text-xl font-black tracking-tight", children: "Logistics & Timing" })] }), _jsx("div", { class: "uk-card uk-card-body border border-border rounded-2xl shadow-sm bg-card/50", children: _jsxs("div", { class: "grid gap-8", children: [_jsxs("form", { class: "autosave grid gap-x-4 gap-y-3 grid-cols-2 lg:grid-cols-3", "hx-post": `/admin/jobs/${job.id}`, "hx-target": "#page-content", "hx-select": "#page-content", "hx-swap": "none", "hx-trigger": "input delay:800ms, change", "hx-sync": "this:queue last", children: [_jsx("input", { type: "hidden", name: "_section", value: "details" }), _jsxs("div", { class: "space-y-1", children: [_jsx("label", { class: "text-[9px] sm:text-[10px] font-black uppercase tracking-wider text-muted-foreground ml-1", for: "scheduled-date", children: "Service Date" }), _jsx("input", { id: "scheduled-date", name: "scheduled_date", type: "date", class: "uk-input rounded-xl border-2 font-bold h-10 sm:h-11 px-2 text-xs sm:text-sm", value: job.scheduled_date })] }), _jsxs("div", { class: "space-y-1", children: [_jsx("label", { class: "text-[9px] sm:text-[10px] font-black uppercase tracking-wider text-muted-foreground ml-1", for: "scheduled-time", children: "Arrival Time" }), _jsx("input", { id: "scheduled-time", name: "scheduled_start_time", type: "time", class: "uk-input rounded-xl border-2 font-bold h-10 sm:h-11 px-2 text-xs sm:text-sm", value: job.scheduled_start_time })] }), _jsxs("div", { class: "space-y-1", children: [_jsx("label", { class: "text-[9px] sm:text-[10px] font-black uppercase tracking-wider text-muted-foreground ml-1", for: "duration", children: "Est. duration" }), _jsxs("div", { class: "relative", children: [_jsx("input", { id: "duration", name: "duration_minutes", type: "number", min: 1, class: "uk-input rounded-xl border-2 font-bold h-10 sm:h-11 pr-8 sm:pr-12 pl-2 text-xs sm:text-sm", value: job.duration_minutes }), _jsx("span", { class: "absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 text-[8px] sm:text-[10px] font-black text-muted-foreground uppercase", children: "Min" })] })] }), _jsxs("div", { class: "space-y-1 col-span-2 lg:col-span-1", children: [_jsx("label", { class: "text-[9px] sm:text-[10px] font-black uppercase tracking-wider text-muted-foreground ml-1", for: "provider-id", children: "Primary Provider" }), _jsxs("select", { id: "provider-id", name: "provider_id", class: "uk-select rounded-xl border-2 font-bold h-10 sm:h-11 px-2 text-xs sm:text-sm", children: [_jsx("option", { value: "", children: "Unassigned" }), team.map((p) => _jsxs("option", { value: p.id, selected: assignedProviderId === p.id, children: [p.first_name, " ", p.last_name] }, p.id))] })] }), _jsxs("div", { class: "space-y-1", children: [_jsx("label", { class: "text-[9px] sm:text-[10px] font-black uppercase tracking-wider text-muted-foreground ml-1", for: "base-price", children: "Base Price" }), _jsxs("div", { class: "relative", children: [_jsx("span", { class: "absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-muted-foreground", children: "$" }), _jsx("input", { id: "base-price", name: "base_price", type: "number", step: "0.01", class: "uk-input rounded-xl border-2 font-bold h-10 sm:h-11 pl-6 sm:pl-8 pr-2 text-xs sm:text-sm", value: (job.base_price_cents / 100).toFixed(2) })] })] }), _jsxs("div", { class: "space-y-1", children: [_jsx("label", { class: "text-[9px] sm:text-[10px] font-black uppercase tracking-wider text-muted-foreground ml-1", for: "total-price", children: "Total Price" }), _jsxs("div", { class: "relative", children: [_jsx("span", { class: "absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-muted-foreground", children: "$" }), _jsx("input", { id: "total-price", name: "total_price", type: "number", step: "0.01", class: "uk-input rounded-xl border-2 font-bold h-10 sm:h-11 pl-6 sm:pl-8 pr-2 text-xs sm:text-sm", value: (job.total_price_cents / 100).toFixed(2) })] })] }), _jsxs("div", { class: "col-span-2 lg:col-span-3 flex items-center justify-between mt-1 sm:mt-2", children: [_jsxs("p", { class: "text-[9px] sm:text-[10px] text-muted-foreground/60 font-medium italic flex items-center gap-1.5 sm:gap-2", children: [_jsxs("svg", { width: "10", height: "10", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", "stroke-width": "2.5", class: "sm:w-3 sm:h-3", children: [_jsx("title", { children: "Auto-save" }), _jsx("path", { d: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 6v6l4 2" })] }), "Changes auto-save"] }), _jsx("span", { class: "save-indicator font-black text-[9px] sm:text-[10px] uppercase tracking-widest text-brand" })] })] }), _jsx("div", { class: "pt-6 border-t border-border/50", children: _jsxs("div", { class: "grid sm:grid-cols-2 gap-6", children: [_jsxs("div", { class: "space-y-4", children: [_jsx("p", { class: "text-[11px] font-black uppercase tracking-widest text-muted-foreground ml-1", children: "Work Execution" }), _jsx("div", { class: "flex flex-wrap gap-3", children: !job.started_at ? (_jsx("button", { type: "button", class: "uk-btn uk-btn-primary flex-1 h-12 rounded-xl font-black shadow-lg shadow-brand/20 transition-all hover:scale-[1.02]", "hx-post": `/admin/jobs/${job.id}/status`, "hx-vals": '{"status": "in_progress"}', "hx-target": "#page-content", "hx-select": "#page-content", children: "START JOB" })) : !job.completed_at ? (_jsx("button", { type: "button", class: "uk-btn uk-btn-primary flex-1 h-12 rounded-xl font-black bg-secondary border-secondary shadow-lg shadow-secondary/20 transition-all hover:scale-[1.02]", "hx-post": `/admin/jobs/${job.id}/status`, "hx-vals": '{"status": "complete"}', "hx-target": "#page-content", "hx-select": "#page-content", children: "END JOB" })) : (_jsxs("div", { class: "flex-1 bg-muted/50 border border-border/50 h-12 rounded-xl flex items-center justify-center gap-2", children: [_jsxs("svg", { width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", "stroke-width": "2.5", class: "text-brand", children: [_jsx("title", { children: "Completed" }), _jsx("path", { d: "M22 11.08V12a10 10 0 1 1-5.93-9.14" }), _jsx("path", { d: "m22 4-10 10.01-3-3" })] }), _jsx("span", { class: "text-xs font-black uppercase tracking-widest text-muted-foreground", children: "Work Completed" })] })) })] }), _jsxs("div", { class: "bg-muted/30 rounded-2xl p-4 border border-border/40 flex flex-col justify-center", children: [_jsx("p", { class: "text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-2", children: "Execution Metrics" }), _jsxs("div", { class: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("p", { class: "text-[9px] font-bold text-muted-foreground/70 uppercase", children: "Start Time" }), _jsx("p", { class: "text-sm font-black", children: job.started_at ? new Date(`${job.started_at}Z`).toLocaleTimeString('en-CA', { hour: '2-digit', minute: '2-digit' }) : '--:--' })] }), _jsxs("div", { children: [_jsx("p", { class: "text-[9px] font-bold text-muted-foreground/70 uppercase", children: "End Time" }), _jsx("p", { class: "text-sm font-black", children: job.completed_at ? new Date(`${job.completed_at}Z`).toLocaleTimeString('en-CA', { hour: '2-digit', minute: '2-digit' }) : '--:--' })] }), _jsxs("div", { class: "col-span-2 pt-2 mt-2 border-t border-border/30", children: [_jsx("p", { class: "text-[9px] font-bold text-muted-foreground/70 uppercase", children: "Actual Duration" }), _jsx("p", { class: "text-lg font-black text-brand", children: actualDuration !== null ? `${actualDuration} Minutes` : 'Calculating...' })] })] })] })] }) })] }) })] })] }), _jsxs("aside", { class: "grid gap-8 content-start", children: [_jsx(SmsThreadCard, { jobId: job.id, smsThreadMessage: smsThreadMessage, customerName: customerName }), _jsxs("section", { id: "billing", children: [_jsxs("div", { class: "flex items-center justify-between mb-4 px-1", children: [_jsx("h3", { class: "text-lg font-black tracking-tight leading-none", children: "Job Billing" }), _jsx("span", { class: "text-sm font-bold text-brand", children: money(subtotal) })] }), _jsxs("div", { class: "uk-card rounded-2xl border border-border bg-card shadow-sm overflow-hidden", children: [_jsxs("div", { class: "divide-y divide-border/50", children: [lineItems.map((line) => (_jsx("div", { class: `p-4 ${line.parent_id ? 'bg-muted/20 pl-8' : ''}`, children: _jsxs("div", { class: "flex items-start justify-between gap-2", children: [_jsxs("div", { class: "min-w-0", children: [_jsx("p", { class: "text-sm font-bold text-foreground leading-tight", children: line.description }), _jsxs("p", { class: "text-[10px] text-muted-foreground mt-1 uppercase font-bold tracking-tighter", children: [line.quantity, " \u00D7 ", money(line.unit_price_cents), " \u2022 ", _jsx("span", { class: "text-brand/80", children: line.kind })] })] }), _jsxs("div", { class: "text-right shrink-0", children: [_jsx("p", { class: "text-sm font-black text-foreground", children: money(line.total_cents) }), line.is_custom === 1 && (_jsx("button", { type: "button", class: "text-[10px] text-destructive uppercase font-black tracking-widest mt-1 hover:underline", "hx-post": `/admin/jobs/${job.id}/line-items/delete`, "hx-vals": JSON.stringify({ lineId: line.id }), "hx-target": "#page-content", "hx-select": "#page-content", "data-confirm": "arm", children: "Remove" }))] })] }) }, line.id))), lineItems.length === 0 && (_jsx("div", { class: "p-8 text-center text-xs text-muted-foreground italic", children: "No billing items recorded." }))] }), _jsx("div", { class: "p-4 bg-muted/30 border-t border-border", children: _jsxs("form", { "hx-post": `/admin/jobs/${job.id}/line-items/add`, "hx-target": "#page-content", "hx-select": "#page-content", "hx-swap": "innerHTML", class: "grid gap-3", children: [_jsxs("div", { class: "grid gap-1.5", children: [_jsx("label", { for: "new-line-desc", class: "text-[9px] font-black uppercase tracking-widest text-muted-foreground ml-1", children: "New Line Description" }), _jsx("input", { id: "new-line-desc", type: "text", name: "description", class: "uk-input text-xs h-10 rounded-xl border-2 border-border/60 bg-card font-bold", placeholder: "e.g. Extra deep cleaning", required: true })] }), _jsxs("div", { class: "grid grid-cols-2 gap-3", children: [_jsxs("div", { class: "grid gap-1.5", children: [_jsx("label", { for: "new-line-price", class: "text-[9px] font-black uppercase tracking-widest text-muted-foreground ml-1", children: "Unit Price" }), _jsxs("div", { class: "relative", children: [_jsx("span", { class: "absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-muted-foreground", children: "$" }), _jsx("input", { id: "new-line-price", type: "number", name: "unit_price", class: "uk-input text-xs h-10 rounded-xl border-2 border-border/60 bg-card pl-6 font-bold", min: 0, step: 0.01, placeholder: "0.00", required: true })] })] }), _jsxs("div", { class: "grid gap-1.5", children: [_jsx("label", { for: "new-line-qty", class: "text-[9px] font-black uppercase tracking-widest text-muted-foreground ml-1", children: "Quantity" }), _jsx("input", { id: "new-line-qty", type: "number", name: "quantity", class: "uk-input text-xs h-10 rounded-xl border-2 border-border/60 bg-card font-bold", min: 1, step: 1, value: "1", required: true })] })] }), _jsx("button", { type: "submit", class: "uk-btn uk-btn-default w-full py-2 text-[10px] font-black uppercase tracking-widest h-10 mt-1 rounded-xl shadow-sm", children: "Add Billing Item" })] }) })] })] }), _jsx("section", { id: "contact", children: _jsxs("div", { class: "uk-card p-6 rounded-2xl border-2 border-border/40 bg-card shadow-sm hover:border-border transition-colors", children: [_jsx("h3", { class: "text-xs uppercase font-black text-muted-foreground tracking-widest mb-4", children: "Contact Profile" }), customer ? (_jsxs("div", { class: "grid gap-4", children: [_jsxs("a", { href: `tel:${customer.phone}`, class: "flex items-center gap-3 group text-foreground no-underline", children: [_jsx("div", { class: "w-10 h-10 rounded-xl bg-muted group-hover:bg-brand/10 group-hover:text-brand flex items-center justify-center transition-colors", children: _jsxs("svg", { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", "stroke-width": "2.5", children: [_jsx("title", { children: "Call Customer" }), _jsx("path", { d: "M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.74 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" })] }) }), _jsx("span", { class: "text-sm font-black group-hover:text-brand transition-colors", children: customer.phone || 'No Phone' })] }), _jsxs("a", { href: `mailto:${customer.email}`, class: "flex items-center gap-3 group text-foreground no-underline", children: [_jsx("div", { class: "w-10 h-10 rounded-xl bg-muted group-hover:bg-brand/10 group-hover:text-brand flex items-center justify-center transition-colors", children: _jsxs("svg", { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", "stroke-width": "2.5", children: [_jsx("title", { children: "Email Customer" }), _jsx("path", { d: "m22 2-7 20-4-9-9-4zM22 2 11 13" })] }) }), _jsx("span", { class: "text-sm font-black group-hover:text-brand transition-colors truncate", children: customer.email || 'No Email' })] }), _jsx("a", { href: `/admin/customers/${customer.id}/edit`, class: "uk-btn uk-btn-default w-full py-2.5 font-bold rounded-xl mt-2 text-xs border-2", "hx-get": `/admin/customers/${customer.id}/edit`, "hx-target": "#page-content", "hx-select": "#page-content", "hx-push-url": "true", children: "View Full Customer Profile" })] })) : (_jsx("p", { class: "text-xs text-muted-foreground italic", children: "No customer profile linked." }))] }) }), _jsx("div", { class: "mt-4 pt-8 border-t border-border/50", children: _jsx("button", { type: "button", class: "delete-btn w-full py-3 font-black uppercase tracking-widest text-[10px] rounded-xl shadow-sm", "hx-post": `/admin/jobs/${job.id}/delete`, "data-confirm": "arm", "hx-target": "#page-content", children: "Permanently Delete Job" }) })] })] })] }) })] }));
};
//# sourceMappingURL=job-detail.js.map