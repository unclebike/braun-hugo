<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" class="no-js {{ with .Site.Params.color_combinations }}is-{{ . | urlize }}{{ end }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    
    <link rel="stylesheet" href="/assets/built/screen.css">
    <style>
        :root.has-light-text,
        :root.dark-page,
        :root[data-theme="dark"] {
            --primary-text-color: #cdd6f4;
            --secondary-text-color: #bac2de;
            --tertiary-text-color: #a6adc8;
            --darker-gray-color: #cdd6f4;
            --divider-color: #313244;
            --input-background-color: #313244;
            --hero-background-color: rgba(205, 214, 244, 0.06);
            --base-contrast: #1e1e2e;
            --overlay-bg: rgba(17, 17, 27, 0.85);
            --primary-text-color-invert: #1e1e2e;
            --secondary-text-color-invert: #181825;
            --tertiary-text-color-invert: #11111b;
            --primary-text-color-overlay: #cdd6f4;
            --secondary-text-color-overlay: #bac2de;
            --tertiary-text-color-overlay: #a6adc8;
            --color-lighter-gray: #313244;
            --color-light-gray: #45475a;
            --color-mid-gray: #585b70;
            --color-dark-gray: #bac2de;
            --color-darker-gray: #cdd6f4;
            --white-color: #cdd6f4;
            --green-color: #a6e3a1;
            --orange-color: #f9e2af;
            --red-color: #f38ba8;
            --background-color: #1e1e2e;
            --background-base: #181825;
        }
    </style>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link rel="icon" type="image/png" href="/favicon.png">
    
    <script>
        document.documentElement.classList.remove('no-js');
        document.documentElement.classList.add('js');
        (function() {
            var saved = localStorage.getItem('theme');
            if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>

    <style>
        .search-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: var(--overlay-bg);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding-top: 12vh;
        }
        .search-overlay.is-active { display: flex; }
        .search-modal {
            width: 90%;
            max-width: 580px;
            background: var(--background-color);
            border-radius: var(--radii-large);
            box-shadow: 0 16px 48px rgba(0,0,0,.2);
            overflow: hidden;
            animation: searchSlideIn .15s ease-out;
        }
        @keyframes searchSlideIn {
            from { opacity: 0; transform: translateY(-12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .search-modal-header {
            display: flex;
            align-items: center;
            padding: 1.6rem 2rem;
            gap: 1.2rem;
            border-bottom: 1px solid var(--divider-color);
        }
        .search-modal-header svg {
            width: 2rem;
            height: 2rem;
            stroke: var(--tertiary-text-color);
            flex-shrink: 0;
        }
        .search-modal-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 1.8rem;
            color: var(--primary-text-color);
            font-family: inherit;
        }
        .search-modal-input::placeholder { color: var(--tertiary-text-color); }
        .search-modal-kbd {
            font-size: 1.2rem;
            color: var(--tertiary-text-color);
            background: var(--input-background-color);
            padding: .2rem .6rem;
            border-radius: .4rem;
            font-family: inherit;
        }
        .search-modal-results {
            max-height: 50vh;
            overflow-y: auto;
            padding: .8rem;
        }
        .search-modal-results:empty { display: none; }
        .search-modal-results mark {
            background: rgba(137, 180, 250, 0.25);
            color: inherit;
        }
        [data-theme="dark"] .search-modal-results mark {
            background: rgba(137, 180, 250, 0.2);
        }
        .search-result-item {
            display: block;
            padding: 1.2rem 1.6rem;
            border-radius: var(--radii-medium);
            color: var(--primary-text-color);
            transition: background .1s;
        }
        .search-result-item:hover { background: var(--color-lighter-gray); opacity: 1; }
        .search-result-title {
            font-size: 1.6rem;
            font-weight: var(--font-weight-bold);
            margin-bottom: .4rem;
        }
        .search-result-excerpt {
            font-size: 1.4rem;
            color: var(--secondary-text-color);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .search-no-results {
            padding: 2.4rem 1.6rem;
            text-align: center;
            color: var(--tertiary-text-color);
            font-size: 1.5rem;
        }
        .search-modal-footer {
            padding: .8rem 2rem;
            border-top: 1px solid var(--divider-color);
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            color: var(--tertiary-text-color);
        }
        .kg-toggle-card, .kg-toggle-card * { box-sizing: border-box; }
        .kg-toggle-card { background: 0; box-shadow: inset 0 0 0 1px rgba(124,139,154,.25); border-radius: 4px; padding: 1.2em; }
        .kg-toggle-card[data-kg-toggle-state="close"] .kg-toggle-content { height: 0; overflow: hidden; opacity: 0; position: relative; top: -.5em; transition: opacity .5s, top .35s; }
        .kg-toggle-content { height: auto; opacity: 1; position: relative; top: 0; transition: opacity 1s, top .35s; }
        .kg-toggle-heading { cursor: pointer; display: flex; justify-content: space-between; align-items: flex-start; }
        h4.kg-toggle-heading-text { font-size: 1.15em; font-weight: 700; line-height: 1.3em; margin: 0; }
        .kg-toggle-content p:first-of-type { margin-top: .5em; }
        .kg-toggle-card .kg-toggle-content ol, .kg-toggle-card .kg-toggle-content p, .kg-toggle-card .kg-toggle-content ul { font-size: .95em; line-height: 1.5em; margin-top: .95em; margin-bottom: 0; }
        .kg-toggle-card-icon { background: 0; border: 0; padding: 0; cursor: pointer; flex-shrink: 0; margin-left: .8em; }
        .kg-toggle-card-icon svg { width: 14px; height: 14px; stroke: currentColor; stroke-width: 2; fill: none; transition: transform .3s; }
        .kg-toggle-card[data-kg-toggle-state="close"] .kg-toggle-card-icon svg { transform: unset; }
        .kg-toggle-card:not([data-kg-toggle-state="close"]) .kg-toggle-card-icon svg { transform: rotate(180deg); }
        .photo-pile { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; padding: 2rem 0; max-width: 720px; margin: 2rem auto 0; }
        .photo-pile .card { padding: .6rem; background: transparent; transition: transform .25s ease, z-index 0s; cursor: default; margin: -8px; }
        .photo-pile .card:hover { transform: scale(1.08) rotate(0deg) !important; z-index: 10; }
        .photo-pile .card img { width: 100%; height: auto; display: block; }
        .photo-pile .card:nth-child(1) { transform: rotate(-3deg); }
        .photo-pile .card:nth-child(2) { transform: rotate(2deg) translateY(6px); }
        .photo-pile .card:nth-child(3) { transform: rotate(-5deg) translateY(-4px); }
        .photo-pile .card:nth-child(4) { transform: rotate(4deg) translateX(5px); }
        .photo-pile .card:nth-child(5) { transform: rotate(-1deg) translateY(8px); }
        .photo-pile .card:nth-child(6) { transform: rotate(6deg) translateY(-6px); }
        .photo-pile .card:nth-child(7) { transform: rotate(-4deg) translateX(-3px); }
        .photo-pile .card:nth-child(8) { transform: rotate(3deg) translateY(5px); }
        .photo-pile .card:nth-child(9) { transform: rotate(-6deg) translateY(-3px); }
        @media (max-width: 600px) { .photo-pile { grid-template-columns: repeat(2, 1fr); padding: 1rem 0; } .photo-pile .card { margin: -4px; } }
        [data-theme="dark"] .photo-pile .card { background: transparent; }
    </style>
</head>
<body class="{{ if .IsHome }}home-template{{ else }}post-template{{ end }}">
    <div class="site">
        {{ partial "header.html" . }}
        
        <div class="site-content">
            {{ block "main" . }}{{ end }}
            
            {{ partial "footer.html" . }}
        </div>
    </div>

    <div class="search-overlay" id="search-overlay">
        <div class="search-modal">
            <div class="search-modal-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input class="search-modal-input" id="search-input" type="text" placeholder="Search..." autocomplete="off" />
                <span class="search-modal-kbd">Esc</span>
            </div>
            <div class="search-modal-results" id="search-results"></div>
        </div>
    </div>
    
    <script src="/assets/built/main.min.js"></script>

    <script>
    (function() {
        var html = document.documentElement;
        var toggles = document.querySelectorAll('.gh-theme-toggle');
        function isDark() { return html.getAttribute('data-theme') === 'dark'; }
        function setTheme(dark) {
            html.setAttribute('data-theme', dark ? 'dark' : 'light');
            localStorage.setItem('theme', dark ? 'dark' : 'light');
        }
        toggles.forEach(function(btn) {
            btn.addEventListener('click', function() { setTheme(!isDark()); });
        });
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (!localStorage.getItem('theme')) setTheme(e.matches);
        });
    })();

    (function() {
        var overlay = document.getElementById('search-overlay');
        var input = document.getElementById('search-input');
        var results = document.getElementById('search-results');
        var pagefind = null;
        var debounceTimer = null;

        function openSearch() {
            overlay.classList.add('is-active');
            document.body.style.overflow = 'hidden';
            input.value = '';
            results.innerHTML = '';
            setTimeout(function() { input.focus(); }, 50);
            if (!pagefind) {
                import('/pagefind/pagefind.js').then(function(pf) {
                    pagefind = pf;
                    pagefind.init();
                }).catch(function() {});
            }
        }
        function closeSearch() {
            overlay.classList.remove('is-active');
            document.body.style.overflow = '';
        }

        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) closeSearch();
        });

        document.addEventListener('keydown', function(e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                if (overlay.classList.contains('is-active')) closeSearch();
                else openSearch();
            }
            if (e.key === 'Escape' && overlay.classList.contains('is-active')) {
                closeSearch();
            }
        });

        document.querySelectorAll('.gh-search, .header-search-bar').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                openSearch();
            });
        });

        input.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            var query = input.value.trim();
            if (!query) { results.innerHTML = ''; return; }
            debounceTimer = setTimeout(function() {
                if (!pagefind) return;
                pagefind.search(query).then(function(search) {
                    if (!search.results.length) {
                        results.innerHTML = '<div class="search-no-results">No results found</div>';
                        return;
                    }
                    Promise.all(search.results.slice(0, 8).map(function(r) { return r.data(); })).then(function(items) {
                        results.innerHTML = items.map(function(item) {
                            return '<a class="search-result-item" href="' + item.url + '">' +
                                '<div class="search-result-title">' + item.meta.title + '</div>' +
                                '<div class="search-result-excerpt">' + item.excerpt + '</div>' +
                                '</a>';
                        }).join('');
                    });
                });
            }, 200);
        });
    })();
    </script>
    
    <script src="https://api.unclebike.xyz/widget/branding.js"></script>
    <script>
      window.ZenbookerPopupConfig = {
        apiUrl: 'https://api.unclebike.xyz',
        primaryColor: (window.ZenbookerBranding || {}).primaryColor || '#2563eb',
        floatingButton: true,
        floatingButtonText: 'Book Now',
        onComplete: function(booking) {
          console.log('Booking completed:', booking);
        }
      };
    </script>
    <script src="https://api.unclebike.xyz/widget/popup.js" defer></script>
    <script>
    (function() {
      var header = document.getElementById('gh-head');
      if (!header || !('IntersectionObserver' in window)) return;
      new IntersectionObserver(function(entries) {
        var btn = document.getElementById('zbw-floating-btn');
        if (!btn) return;
        btn.style.opacity = entries[0].isIntersecting ? '0' : '1';
        btn.style.pointerEvents = entries[0].isIntersecting ? 'none' : 'auto';
      }, { threshold: 0 }).observe(header);
    })();
    document.querySelectorAll('.kg-toggle-heading').forEach(function(h) {
      h.addEventListener('click', function() {
        var card = h.closest('.kg-toggle-card');
        if (!card) return;
        card.dataset.kgToggleState = card.dataset.kgToggleState === 'close' ? 'open' : 'close';
      });
    });
    </script>
</body>
</html>
